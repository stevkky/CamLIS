$(function(){var $btnSubmitPatientForm=$("#btnSubmitPatientForm"),$print_preview_covid_form_modal_1=$("#print_preview_covid_form_modal"),$modal_error_line_list=$("#modal_error_line_list");function getProvinceCode_(e){var t="";return"kh"==app_language?$.each(PROVINCES,function(a,l){if(l.name_kh==e)return t=l.code,!1}):$.each(PROVINCES,function(a,l){if(l.name_en==e)return t=l.code,!1}),t}function getDistrictCode_(e,t){var a="";return"kh"==app_language?$.each(DISTRICTS,function(l,n){if(n.name_kh==e&&n.province_code==t)return a=n.code,!1}):$.each(DISTRICTS,function(l,n){if(n.name_en==e&&n.province_code==t)return a=n.code,!1}),a}function getCommuneCode_(e,t){var a="";return"kh"==app_language?$.each(COMMUNES,function(l,n){if(n.name_kh==e&&n.district_code==t)return a=n.code,!1}):$.each(COMMUNES,function(l,n){if(n.name_en==e&&n.district_code==t)return a=n.code,!1}),a}function getVillageCode_(e,t){var a="";return"kh"==app_language?$.each(VILLAGES,function(l,n){if(n.name_kh==e&&n.commune_code==t)return a=n.code,!1}):$.each(VILLAGES,function(l,n){if(n.name_en==e&&n.commune_code==t)return a=n.code,!1}),a}function getReason_(e){var t="";return $.each(REASON_FOR_TESTING_ARR,function(a,l){if(l==e)return t=a,!1}),t}function getSampleSource(e){var t="";return $.each(SAMPLE_SOURCE,function(a,l){if(l.source_name==e)return t=l.source_id,!1}),t}function getRequester(e,t){var a="";return $.each(REQUESTER,function(l,n){if(n.requester_name==e&&n.sample_source_id==t)return a=n.requester_id,!1}),a}function getClinicalSymptom_(e){var t=e.split(";"),a="";if("kh"==app_language)for(var l in t)$.each(CLINICAL_SYMPTOM,function(e,n){if(n.name_kh==t[l])return a+=n.ID+";",!1});else for(var l in t)$.each(CLINICAL_SYMPTOM,function(e,n){if(n.name_en==t[l])return a+=n.ID+";",!1});return a}function getTestResultId(e,t){var a="",l=result_arr[t];return $.each(l,function(l,n){if(n.organism_name==e&&n.sample_test_id==t)return a=n.test_organism_id,!1}),a}function getTest(e){var t="";return $.each([{id:479,test_name:"SARS-CoV-2 (Method: real time RT-PCR by GeneXpert)"},{id:497,test_name:"SARS-CoV-2 (Applied Biosystems 7500 Fast Real Time PCR)"},{id:505,test_name:"SARS-CoV-2 Rapid Antigen Test"},{id:507,test_name:"SARS-CoV-2 (Method: real time RT-PCR by Cobas 6800)"}],function(a,l){if(l.test_name==e)return t=l.id,!1}),t}function getCountry(e){var t="";return $.each(COUNTRIES,function(a,l){if(l.name_en==e)return t=l.num_code,!1}),t}function getNationality(e){var t="";return $.each(NATIONALITIES,function(a,l){if(l.nationality_en==e)return t=l.num_code,!1}),t}function getPerformer(e){var t="";return $.each(PERFORMERS,function(a,l){if(l.performer_name==e)return t=l.ID,!1}),t}function getVaccinationStatus(e){var t="";return $.each(VACCINATION_STATUS_ARR,function(a,l){if(e==l)return t=a,!1}),t}function getVaccinationStatusString(e){var t="";return $.each(VACCINATION_STATUS_ARR,function(a,l){if(e==a)return t=l,!1}),t}function getVaccineCode(e){var t="";return $.each(VACCINE_TYPE_ARR,function(a,l){if(e==l.name)return t=l.id,!1}),t}function getVaccineName(e){var t="";return $.each(VACCINE_TYPE_ARR,function(a,l){if(e==l.id)return t=l.name,!1}),t}var today=new Date,dd=String(today.getDate()).padStart(2,"0"),mm=String(today.getMonth()+1).padStart(2,"0"),yyyy=today.getFullYear();today=yyyy+"-"+mm+"-"+dd;var col_name={patient_code:0,patient_name:1,age:2,gender:3,phone:4,province:5,district:6,commune:7,village:8,residence:9,reason_for_testing:10,is_contacted:11,is_contacted_with:12,is_directed_contact:13,sample_number:14,sample_source:15,requester:16,collected_date:17,received_date:18,payment_type:19,admission_date:20,diagnosis:21,is_urgent:22,completed_by:23,phone_completed_by:24,sample_collector:25,phone_number_sample_collctor:26,clinical_symptom:27,health_facility:28,test_name:29,machine_name:30,test_result:31,test_result_date:32,perform_by:33,country:34,nationality:35,arrival_date:36,passport_number:37,flight_number:38,seat_number:39,is_positive_covid:40,test_date:41,sex_id:42,province_code:43,district_code:44,commune_code:45,village_code:46,reason_for_testing_id:47,sample_source_id:48,requester_id:49,clinical_symtop_id:50,test_id:51,country_id:52,nationality_id:53,number_of_sample:54,performer_by_id:55,test_result_id:56,is_camlis_patient:57,vaccination_status:58,first_vaccinated_date:59,second_vaccinated_date:60,vaccine_name:61,third_vaccinated_date:62,second_vaccine_name:63,forth_vaccinated_date:64,third_vaccine_name:65,occupation:66,vaccination_status_code:67,vaccine_id:68,second_vaccine_id:69,third_vaccine_id:70},letter_col_name={patient_code:"A",patient_name:"B",age:"C",gender:"D",phone:"E",province:"F",district:"G",commune:"H",village:"I",residence:"J",reason_for_testing:"K",is_contacted:"L",is_contacted_with:"M",is_directed_contact:"N",sample_number:"O",sample_source:"P",requester:"Q",collected_date:"R",received_date:"S",payment_type:"T",admission_date:"U",diagnosis:"V",is_urgent:"W",completed_by:"X",phone_completed_by:"Y",sample_collector:"Z",phone_number_sample_collctor:"AA",clinical_symptom:"AB",health_facility:"AC",test_name:"AD",machine_name:"AE",test_result:"AF",test_result_date:"AG",perform_by:"AH",country:"AI",nationality:"AJ",arrival_date:"AK",passport_number:"AL",flight_number:"AM",seat_number:"AN",is_positive_covid:"AO",test_date:"AP",number_of_sample:"AQ",vaccination_status:"AR",first_vaccinated_date:"AS",second_vaccinated_date:"AT",vaccine_name:"AU",occupation:"AV"},province_array=[],districts_array=[],communes_array=[],villages_array=[],nationalities_array=[],country_array=[],requester_array=[],reason_for_testing_array=[],clinical_symptom_array=[],sample_source_array=[],payment_type_array=[],performer_array=[],gender_array=[],test_name_array=["SARS-CoV-2 (Method: real time RT-PCR by GeneXpert)","SARS-CoV-2 (Applied Biosystems 7500 Fast Real Time PCR)","SARS-CoV-2 Rapid Antigen Test","SARS-CoV-2 (Method: real time RT-PCR by Cobas 6800)"],machine_name_array=[],test_result_array=[],maxRow=500,maxLengthPatientCode=30,vaccination_status_array=[],vaccine_type_array=[],check_patients=[],maxSampleNumber=11,machine_name_arr={497:[],479:[],505:[],507:[]},result_arr={497:[],479:[],505:[]},getTestResult=function(e){$.ajax({url:base_url+"organism/get_sample_test_organism",type:"POST",data:{sample_test_id:e},dataType:"json",success:function(t){result_arr[e]=t,t.forEach(function(e){test_result_array.push(e.organism_name)})}})},getMachineName=function(e){$.ajax({url:base_url+"machine",type:"POST",dataType:"json",data:{id:e,lab_id:LABORATORY_SESSION.labID},success:function(t){machine_name_arr[e]=t,t.forEach(function(e){machine_name_array.push(e.machine_name)})},error:function(){}})};getTestResult(497),getTestResult(479),getTestResult(505),getTestResult(507),getMachineName(497),getMachineName(479),getMachineName(505),getTestResult(507),"kh"==app_language?($.each(PROVINCES,function(e,t){province_array.push(t.name_kh)}),$.each(DISTRICTS,function(e,t){districts_array.push(t.name_kh)}),$.each(COMMUNES,function(e,t){communes_array.push(t.name_kh)}),$.each(VILLAGES,function(e,t){villages_array.push(t.name_kh)}),$.each(CLINICAL_SYMPTOM,function(e,t){clinical_symptom_array.push(t.name_kh)}),gender_array=["ប្រុស","ស្រី"]):($.each(PROVINCES,function(e,t){province_array.push(t.name_en)}),$.each(DISTRICTS,function(e,t){districts_array.push(t.name_en)}),$.each(COMMUNES,function(e,t){communes_array.push(t.name_en)}),$.each(VILLAGES,function(e,t){villages_array.push(t.name_en)}),$.each(CLINICAL_SYMPTOM,function(e,t){clinical_symptom_array.push(t.name_en)}),gender_array=["Male","Female"]),$.each(NATIONALITIES,function(e,t){nationalities_array.push(t.nationality_en)}),$.each(COUNTRIES,function(e,t){country_array.push(t.name_en)}),$.each(REQUESTER,function(e,t){requester_array.push(t.requester_name)}),$.each(REASON_FOR_TESTING_ARR,function(e,t){reason_for_testing_array.push(t)}),$.each(SAMPLE_SOURCE,function(e,t){sample_source_array.push(t.source_name)}),$.each(PERFORMERS,function(e,t){performer_array.push(t.performer_name)}),$.each(PAYMENT_TYPE,function(e,t){payment_type_array.push({id:t.id,name:t.name})}),$.each(VACCINATION_STATUS_ARR,function(e,t){vaccination_status_array.push(t)}),$.each(VACCINE_TYPE_ARR,function(e,t){vaccine_type_array.push(t.name)});var province_code="",district_code="",commune_code="",districtFilter2=function(e,t,a,l,n){var _=e.jexcel.getValueFromCoords(col_name.province,l),r=[];return"kh"==app_language?($.each(PROVINCES,function(e,t){if(t.name_kh==_)return province_code=t.code,!1}),$.each(DISTRICTS,function(e,t){province_code==t.province_code&&r.push(t.name_kh)})):($.each(PROVINCES,function(e,t){if(t.name_en==_)return province_code=t.code,!1}),$.each(DISTRICTS,function(e,t){province_code==t.province_code&&r.push(t.name_en)})),r},communeFilter2=function(e,t,a,l,n){var _=e.jexcel.getValueFromCoords(col_name.district,l),r=[],s=e.jexcel.getValueFromCoords(col_name.province_code,l);return"kh"==app_language?($.each(DISTRICTS,function(e,t){if(t.name_kh==_&&t.province_code==s)return district_code=t.code,!1}),$.each(COMMUNES,function(e,t){district_code==t.district_code&&r.push(t.name_kh)})):($.each(DISTRICTS,function(e,t){if(t.name_en==_&&t.province_code==s)return district_code=t.code,!1}),$.each(COMMUNES,function(e,t){district_code==t.district_code&&r.push(t.name_en)})),r},villageFilter2=function(e,t,a,l,n){var _=e.jexcel.getValueFromCoords(col_name.commune,l),r=[],s=e.jexcel.getValueFromCoords(col_name.district_code,l);return"kh"==app_language?($.each(COMMUNES,function(e,t){if(t.name_kh==_&&t.district_code==s)return commune_code=t.code,!1}),$.each(VILLAGES,function(e,t){commune_code==t.commune_code&&r.push(t.name_kh)})):($.each(COMMUNES,function(e,t){if(t.name_en==_&&t.district_code==s)return commune_code=t.code,!1}),$.each(VILLAGES,function(e,t){commune_code==t.commune_code&&r.push(t.name_en)})),r},requesterFilter2=function(e,t,a,l,n){e.jexcel.getValueFromCoords(a-1,l);var _=e.jexcel.getValueFromCoords(col_name.sample_source_id,l),r=[];return $.each(REQUESTER,function(e,t){_==t.sample_source_id&&r.push(t.requester_name)}),r},machineNameFilter=function(e,t,a,l,n){var _=e.jexcel.getValueFromCoords(col_name.test_id,l),r=[],s=machine_name_arr[_];if(s.length>0)for(var i in s)r.push(s[i].machine_name);return r},testResultFilter=function(e,t,a,l,n){var _=e.jexcel.getValueFromCoords(col_name.test_id,l),r=[],s=result_arr[_];if(s.length>0)for(var i in s)r.push(s[i].organism_name);return r},machineNameFilterShortForm=function(e,t,a,l,n){var _=$modal_excel_short_form.find("select[name=test_name]").val(),r=[];if("-1"!==_){var s=machine_name_arr[_];if(s.length>0)for(var i in s)r.push(s[i].machine_name)}return r},testResultFilterShortForm=function(e,t,a,l,n){var _=$modal_excel_short_form.find("select[name=test_name]").val(),r=[];if("-1"!==_){var s=result_arr[_];if(s.length>0)for(var i in s)r.push(s[i].organism_name)}return r};$(document).on("click","button.btnPrintCovidFormV1",function(e){e.preventDefault();var t=$(this).attr("data-psample_id");$print_preview_covid_form_modal_1.find(".modal-dialog").empty(),$print_preview_covid_form_modal_1.data("patient_sample_id",t),$print_preview_covid_form_modal_1.find("#doPrinting").off("click").on("click",function(e){e.preventDefault();var a=$("#department_result_view_optional").val(),l=$("#sample_result_view_optional").val();null==a&&(a="",l=""),printpage(base_url+"result/patient_covid_forms/print/"+t+"/"+encodeURIComponent(a)+"/"+encodeURIComponent(l))}),myDialog.showProgress("show",{text:msg_loading}),$.ajax({url:base_url+"result/patient_covid_forms/preview/"+t,type:"POST",dataType:"json",data:{department_optional_view:$("#department_result_view_optional").val(),sample_optional_view:$("#sample_result_view_optional").val()},success:function(e){for(var t in e){var a=$("<div class='psample-result'></div>");a.attr("id","presult-"+(parseInt(t)+1)),a.data("patient_sample_id",e[t].patient_sample_id),a.html(e[t].template),$print_preview_covid_form_modal_1.find(".modal-dialog").append(a)}$print_preview_covid_form_modal_1.find(".page-count").text(e.length),$print_preview_covid_form_modal_1.find(".page-number").val(1),$print_preview_covid_form_modal_1.find(".page-number").autoNumeric({aPad:0,vMin:1,vMax:e.length}),setTimeout(function(){myDialog.showProgress("hide"),$print_preview_covid_form_modal_1.modal("show")},400)},error:function(){myDialog.showProgress("hide"),$print_preview_covid_form_modal_1.modal("show"),$print_preview_covid_form_modal_1.find(".modal-dialog").empty()}})});var PATIENT_RRT=[];function savePatients(e){PATIENT_RRT=e}var $modalPatientTmp=$("#modal_patient_tmp");$("#btnPullData").on("click",function(){$(this).addClass("disabled"),$("#btnImportPatient").addClass("disabled"),myDialog.showProgress("show");var rrt_user=$modalPatientTmp.find("select[name=rrt_dd] option:selected").val(),date=$modalPatientTmp.find("input[name=collected_date]").data("DateTimePicker").date();if(0==rrt_user||null==date)return myDialog.showProgress("hide"),myDialog.showDialog("show",{text:"សូមបញ្ចូលទិន្នន័យជាមុនសិន...",style:"warning"}),$(this).removeClass("disabled"),!1;var collected_date=date.format("YYYY-MM-DD");$.ajax({url:base_url+"/rrt/get_patients",type:"POST",data:{user:rrt_user,date:collected_date},dataType:"json",success:function(e){var t=e.patients,a="",l=1;if(0==t.length)a+="<tr><td colspan=24>ពុំមានទិន្នន័យ</td></tr>";else for(var n in savePatients(t),t){var _=null==t[n].phone?" &nbsp;":t[n].phone,r=null==t[n].residence?" &nbsp;":t[n].residence,s=null==t[n].country_name_en?"&nbsp;":t[n].country_name_en,i=null==t[n].nationality_en?"&nbsp;":t[n].nationality_en,o=null==t[n].date_arrival?" &nbsp;":t[n].date_arrival,c=null==t[n].passport_number?"&nbsp; ":t[n].passport_number,m=null==t[n].flight_number?" &nbsp;":t[n].flight_number,d=null==t[n].seat_number?" &nbsp;":t[n].seat_number,u=null==t[n].sample_source?"&nbsp; ":t[n].sample_source,p=null==t[n].sample_collector?"&nbsp; ":t[n].sample_collector,h=null==t[n].phone_number?" &nbsp;":t[n].phone_number,g=null==t[n].for_labo?" &nbsp;":t[n].for_labo;a+="<tr>",a+="<td>"+l+"</td>",a+="<td>"+t[n].patient_code+"</td>",a+="<td>"+t[n].name+"</td>",a+="<td>"+t[n].age+"</td>",a+="<td>"+t[n].sex+"</td>",a+="<td>"+_+"</td>",a+="<td>"+r+"</td>",a+="<td>"+t[n].province_en+"</td>",a+="<td>"+t[n].district_kh+"</td>",a+="<td>"+t[n].commune_kh+"</td>",a+="<td>"+t[n].village_kh+"</td>",a+="<td>"+s+"</td>",a+="<td>"+i+"</td>",a+="<td>"+o+"</td>",a+="<td>"+c+"</td>",a+="<td>"+m+"</td>",a+="<td>"+d+"</td>",a+="<td>"+u+"</td>",a+="<td>"+t[n].collected_date+"</td>",a+="<td>"+t[n].number_of_sample+"</td>",a+="<td>"+p+"</td>",a+="<td>"+h+"</td>",a+="<td>"+g+"</td>",a+="</tr>",l++}setTimeout(function(){$("#btnPullData").removeClass("disabled"),myDialog.showProgress("hide"),$("table[name=tblListPatient] tbody").html(a),t.length>0&&$("#btnImportPatient").removeClass("disabled"),$modalPatientTmp.modal("show")},1e3)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");console.log(err.Message),console.log(xhr.responseText)}})}),$("#btnOpenRrtFormModal").on("click",function(e){$modalPatientTmp.modal("show")}),$("#btnImportPatient").on("click",function(e){$(this).addClass("disabled"),myDialog.showProgress("show");var t=0;for(var a in PATIENT_RRT){var l="M"==PATIENT_RRT[a].sex?"ប្រុស":"ស្រី",n=null==PATIENT_RRT[a].phone?"":PATIENT_RRT[a].phone,_=null==PATIENT_RRT[a].residence?"":PATIENT_RRT[a].residence,r=null==PATIENT_RRT[a].country_name_en?"":PATIENT_RRT[a].country_name_en,s=null==PATIENT_RRT[a].nationality_en?"":PATIENT_RRT[a].nationality_en,i=null==PATIENT_RRT[a].date_arrival?"":PATIENT_RRT[a].date_arrival,o=null==PATIENT_RRT[a].passport_number?"":PATIENT_RRT[a].passport_number,c=null==PATIENT_RRT[a].flight_number?"":PATIENT_RRT[a].flight_number,m=null==PATIENT_RRT[a].seat_number?"":PATIENT_RRT[a].seat_number,d=null==PATIENT_RRT[a].sample_source?"":PATIENT_RRT[a].sample_source,u=null==PATIENT_RRT[a].sample_collector?" ":PATIENT_RRT[a].sample_collector,p=null==PATIENT_RRT[a].phone_number?"":PATIENT_RRT[a].phone_number;line_list_table.setValue(jspreadsheet.getColumnNameFromId([patient_name_col,t]),PATIENT_RRT[a].name),line_list_table.setValue(jspreadsheet.getColumnNameFromId([gender_col,t]),l),line_list_table.setValue(jspreadsheet.getColumnNameFromId([age_col,t]),PATIENT_RRT[a].age),line_list_table.setValue(jspreadsheet.getColumnNameFromId([phone_col,t]),n),line_list_table.setValue(jspreadsheet.getColumnNameFromId([province_col,t]),PATIENT_RRT[a].province_kh),line_list_table.setValue(jspreadsheet.getColumnNameFromId([arrival_date_col,t]),i),line_list_table.setValue(jspreadsheet.getColumnNameFromId([district_col,t]),PATIENT_RRT[a].district_kh),line_list_table.setValue(jspreadsheet.getColumnNameFromId([commune_col,t]),PATIENT_RRT[a].commune_kh),line_list_table.setValue(jspreadsheet.getColumnNameFromId([village_col,t]),PATIENT_RRT[a].village_kh),line_list_table.setValue(jspreadsheet.getColumnNameFromId([residence_col,t]),_),line_list_table.setValue(jspreadsheet.getColumnNameFromId([sample_source_col,t]),d),line_list_table.setValue(jspreadsheet.getColumnNameFromId([collected_date_col,t]),PATIENT_RRT[a].collected_date),line_list_table.setValue(jspreadsheet.getColumnNameFromId([sample_collector_col,t]),u),line_list_table.setValue(jspreadsheet.getColumnNameFromId([phone_number_sample_collector,t]),p),line_list_table.setValue(jspreadsheet.getColumnNameFromId([country_col,t]),r),line_list_table.setValue(jspreadsheet.getColumnNameFromId([nationality_col,t]),s),line_list_table.setValue(jspreadsheet.getColumnNameFromId([passport_number_col,t]),o),line_list_table.setValue(jspreadsheet.getColumnNameFromId([flight_number_col,t]),c),line_list_table.setValue(jspreadsheet.getColumnNameFromId([seat_number_col,t]),m),line_list_table.setValue(jspreadsheet.getColumnNameFromId([number_of_sample_col,t]),PATIENT_RRT[a].number_of_sample),t++}setTimeout(function(){myDialog.showProgress("hide"),$modalPatientTmp.modal("hide"),$("table[name=tblListPatient] tbody").html(""),$("#btnImportPatient").removeClass("disabled")},1e3)}),$("#btnAddPatientsNew").on("click",function(e){$("#modal-excel-full-form").modal("show")});var data_tmp=[];for(m=0;m<maxRow;m++)data_tmp.push(["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","2021/07/01 00:00"]);var line_list_table_new=jspreadsheet(document.getElementById("spreadsheetNew"),{data:data_tmp,minDimensions:[24,500],defaultColWidth:100,tableOverflow:!0,tableHeight:"500px",columns:[{type:"text",title:label_patient_id,width:140,maxlength:20},{type:"text",title:label_patient_name+"*",maxlength:60},{type:"numeric",title:label_patient_age+"*",width:40,maxlength:3},{type:"dropdown",title:label_sex+"*",width:60,source:gender_array},{type:"text",title:label_patient_phone_number,maxlength:100},{type:"autocomplete",title:label_province+"*",width:100,source:province_array},{type:"autocomplete",title:label_district+"*",width:100,source:districts_array,filter:districtFilter2},{type:"autocomplete",title:label_commune+"*",width:100,source:communes_array,filter:communeFilter2},{type:"autocomplete",title:label_village+"*",width:100,source:villages_array,filter:villageFilter2},{type:"text",title:label_residence,width:80,maxlength:100},{type:"autocomplete",title:label_reason_for_testing+"*",width:120,source:reason_for_testing_array},{type:"checkbox",title:label_yes,width:100},{type:"text",title:label_contact_with,readOnly:!0,maxlength:60},{type:"checkbox",title:label_is_direct_contact},{type:"text",title:label_sample_number,width:120,maxlength:11},{type:"dropdown",title:label_sample_source+"*",width:100,source:sample_source_array},{type:"dropdown",title:label_requester+"*",width:120,source:requester_array,filter:requesterFilter2},{type:"calendar",title:label_collect_dt+"*",width:170,options:{format:"YYYY-MM-DD",time:!0,readonly:!0,validRange:["2021-01-01",today]}},{type:"calendar",title:label_receive_dt+"*",width:170,options:{format:"YYYY-MM-DD",time:!0,readonly:!0,validRange:["2021-01-01",today]}},{type:"autocomplete",title:label_payment_type+"*",width:120,source:payment_type_array},{type:"calendar",title:"ថ្ងៃចូលសម្រាកពេទ្យ",width:120,options:{format:"YYYY-MM-DD",time:!0,readonly:!0}},{type:"text",title:label_clinical_history,width:80,maxlength:60},{type:"checkbox",title:label_urgent,width:50},{type:"text",title:label_completed_by,width:160,maxlength:50},{type:"text",title:label_phone,maxlength:10},{type:"text",title:label_sample_collector,maxlength:50},{type:"text",title:label_phone,maxlength:10},{type:"dropdown",title:label_clinical_symtom,width:150,source:clinical_symptom_array,autocomplete:!0,multiple:!0},{type:"text",title:label_health_facility,maxlength:150},{type:"dropdown",title:label_test_name,width:150,source:test_name_array},{type:"dropdown",title:label_machine_name,width:150,source:machine_name_array,filter:machineNameFilter,readOnly:!0},{type:"dropdown",title:label_result,width:70,source:test_result_array,filter:testResultFilter,readOnly:!0},{type:"calendar",title:label_test_date,width:150,readOnly:!0,options:{format:"YYYY-MM-DD",validRange:["2021-01-01",today]}},{type:"autocomplete",title:label_performed_by,width:120,source:performer_array,readOnly:!0},{type:"text",title:label_country,width:80,maxlength:150},{type:"autocomplete",title:label_nationality,width:80,source:nationalities_array},{type:"calendar",title:label_date_of_arrival,width:100,options:{format:"YYYY-MM-DD",readonly:!0}},{type:"text",title:label_passport_no,width:80,maxlength:20},{type:"text",title:label_flight_number,maxlength:10},{type:"text",title:label_seat_no,width:60,maxlength:5},{type:"checkbox",title:label_yes,width:60},{type:"calendar",title:label_test_covid_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"text",title:"sex"},{type:"text",title:"province_code"},{type:"text",title:"district_code"},{type:"text",title:"commune_code"},{type:"text",title:"village_code"},{type:"text",title:"reason_for_testing"},{type:"text",title:"sample_source_id"},{type:"text",title:"requester_id"},{type:"text",title:"clinical_symtom_id"},{type:"text",title:"test_id"},{type:"text",title:"country_id"},{type:"text",title:"nationality_id"},{type:"dropdown",title:label_number_of_sample,width:120,source:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]},{type:"text",title:"performer_by_id"},{type:"text",title:"test_result_id"},{type:"text",title:"is_camlis_patient"},{type:"dropdown",title:label_vaccination_status,source:vaccination_status_array},{type:"calendar",title:label_first_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"calendar",title:label_second_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"dropdown",title:label_vaccine_type,source:vaccine_type_array,readOnly:!0,width:90},{type:"calendar",title:label_third_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"dropdown",title:label_vaccine_type,source:vaccine_type_array,readOnly:!0,width:90},{type:"calendar",title:label_forth_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"dropdown",title:label_vaccine_type,source:vaccine_type_array,readOnly:!0,width:90},{type:"text",title:label_occupation,maxlength:100},{type:"text",title:"vaccination_status_code"},{type:"text",title:"vaccine_id"},{type:"text",title:"second_vaccine_id"},{type:"text",title:"third_vaccine_id"}],nestedHeaders:[[{title:label_patient_info,colspan:"14"},{title:label_sample_info,colspan:"17"},{title:label_patient_info,colspan:"8"},{title:label_sample_info,colspan:"1"},{title:label_patient_info,colspan:"10"}],[{title:label_patient,colspan:"5"},{title:label_address,colspan:"6"},{title:label_if_contact,colspan:"3"},{title:label_sample,colspan:"12"},{title:label_test_result,colspan:"5"},{title:label_patient_info,colspan:"6"},{title:label_history_of_covid19_history,colspan:"2"},{title:label_sample,colspan:"1"},{title:label_covid_questionaire,colspan:"10"}]],onchange:function(e,t,a,l,n){var _=parseInt(l)+1;if(0==a){_=l;var r,s=1;if(""!==n){var i=n;$.ajax({url:base_url+"patient/search/"+i,type:"POST",data:{pid:i},dataType:"json",success:function(t){console.log(t);var n=t.patient;if(n){check_patients[l]=!0;if("kh"==app_language)var _="M"==n.sex?"ប្រុស":"ស្រី",i=n.province_kh,o=n.district_kh,c=n.commune_kh,m=n.village_kh;else _="M"==n.sex?"Male":"Female",i=n.province_en,o=n.district_en,c=n.commune_en,m=n.village_en;var d=moment(n.dob,"YYYY-MM-DD"),u=calculateAge(d),p=null!=n.is_positive_covid&&null!=n.is_positive_covid&&0!=n.is_positive_covid&&n.is_positive_covid,h=null!=n.is_contacted&&null!=n.is_contacted&&n.is_contacted,g=null==n.contact_with||null==n.contact_with?"":n.contact_with,b=null!=n.is_direct_contact&&null!=n.is_direct_contact&&n.is_direct_contact,f=null==n.test_date||null==n.test_date?"":n.test_date,v=n.name,y=null==n.residence||null==n.residence?"":n.residence,x=null==n.date_arrival||null==n.date_arrival?"":n.date_arrival,C=null==n.country_name_en||null==n.country_name_en?"":n.country_name_en;C=null==n.country_name||null==n.country_name?"":n.country_name;var j=null==n.nationality_en||null==n.nationality_en?"":n.nationality_en,w=null==n.passport_number||null==n.passport_number?"":n.passport_number,I=null==n.flight_number||null==n.flight_number?"":n.flight_number,N=null==n.seat_number||null==n.seat_number?"":n.seat_number,F=null==n.phone||null==n.phone?"":n.phone.trim(),V=null==t.is_camlis_patient?0:1,k=null==n.vaccination_status||null==n.vaccination_status?"":n.vaccination_status,R=null==n.vaccine_id||null==n.vaccine_id?"":n.vaccine_id,S=null==n.first_vaccinated_date||null==n.first_vaccinated_date?"":n.first_vaccinated_date,T=null==n.second_vaccinated_date||null==n.second_vaccinated_date?"":n.second_vaccinated_date,q=null==n.occupation||null==n.occupation?"":n.occupation,$=null==n.second_vaccine_id||null==n.second_vaccine_id?"":n.second_vaccine_id,D=null==n.third_vaccinated_date||null==n.third_vaccinated_date?"":n.third_vaccinated_date,E=null==n.forth_vaccinated_date||null==n.forth_vaccinated_date?"":n.forth_vaccinated_date,O=null==n.third_vaccine_id||null==n.third_vaccine_id?"":n.third_vaccine_id,A=[v,u.years,_,F,i,o,c,m,y];for(r=0;r<9;r++){var M=jspreadsheet.getColumnNameFromId([a+s,l]);e.jexcel.setValue(M,A[r]),s++}if(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,l]),h),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),g),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),b),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.country,l]),C),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,l]),j),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,l]),x),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,l]),w),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,l]),I),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,l]),N),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,l]),p),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),f),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_camlis_patient,l]),V),""!==k){var Y=getVaccinationStatusString(k);e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,l]),Y);var P=getVaccineName(R),L=getVaccineName($);e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),P),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),S),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),T),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),L),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),D);var H=getVaccineName(O);e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_name,l]),H),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.forth_vaccinated_date,l]),E)}e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,l]),q)}else if(void 0!==check_patients[l]&&1==check_patients[l]){for(check_patients[l]=!1,s=1,r=0;r<9;r++){M=jspreadsheet.getColumnNameFromId([a+s,l]);e.jexcel.setValue(M,""),s++}e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.country,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_camlis_patient,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),S),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),T),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,l]),"")}}})}else{for(s=1,r=0;r<9;r++){var o=jspreadsheet.getColumnNameFromId([a+s,l]);e.jexcel.setValue(o,""),s++}e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.country,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_camlis_patient,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),first_vaccinated_date),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),second_vaccinated_date),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,l]),"")}}if(a==col_name.gender&&""!==n&&("kh"==app_language?sex="ប្រុស"==n?1:2:sex="Male"==n?1:2,e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.sex_id,l]),sex),line_list_table_new.setComments("D"+_,"")),a==col_name.province&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.district,l]),""),code=getProvinceCode_(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.province_code,l]),code),line_list_table_new.setComments(letter_col_name.province+_,"")),a==col_name.district&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.commune,l]),""),province_code=line_list_table_new.getValueFromCoords(col_name.province_code,l),code=getDistrictCode_(n,province_code),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.district_code,l]),code),line_list_table_new.setComments(letter_col_name.district+_,"")),a==col_name.commune&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.village,l]),""),district_code=line_list_table_new.getValueFromCoords(col_name.district_code,l),code=getCommuneCode_(n,district_code),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.commune_code,l]),code),line_list_table_new.setComments(letter_col_name.commune+_,"")),a==col_name.village&&""!==n&&(commune_code=line_list_table_new.getValueFromCoords(col_name.commune_code,l),code=getVillageCode_(n,commune_code),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.village_code,l]),code),line_list_table_new.setComments(letter_col_name.village+_,"")),a==col_name.reason_for_testing&&""!==n&&(code=getReason_(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.reason_for_testing_id,l]),code),line_list_table_new.setComments(letter_col_name.reason_for_testing+_,"")),a==col_name.is_contacted){var c=jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),m=jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]);n?(line_list_table_new.setReadOnly(c,!1),line_list_table_new.setReadOnly(m,!1)):(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),""),line_list_table_new.setReadOnly(c,!0),line_list_table_new.setReadOnly(m,!0))}if(a==col_name.sample_source&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.requester,l]),""),code=getSampleSource(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.sample_source_id,l]),code),line_list_table_new.setComments(letter_col_name.sample_source+_,"")),a==col_name.requester&&""!==n){sample_source_id=line_list_table_new.getValueFromCoords(col_name.sample_source_id,l),code=getRequester(n,sample_source_id);var d=jspreadsheet.getColumnNameFromId([col_name.requester_id,l]);e.jexcel.setValue(d,code),line_list_table_new.setComments(letter_col_name.requester+_,"")}if(a==col_name.collected_date&&""!==n&&line_list_table_new.setComments(letter_col_name.collected_date+_,""),a==col_name.received_date&&""!==n&&line_list_table_new.setComments(letter_col_name.received_date+_,""),a==col_name.clinical_symptom&&""!==n&&(code=getClinicalSymptom_(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.clinical_symtop_id,l]),code),line_list_table_new.setComments(letter_col_name.clinical_symptom+_,"")),a==col_name.test_name){var u=jspreadsheet.getColumnNameFromId([col_name.test_result,l]),p=jspreadsheet.getColumnNameFromId([col_name.test_result_date,l]),h=jspreadsheet.getColumnNameFromId([col_name.perform_by,l]),g=jspreadsheet.getColumnNameFromId([col_name.machine_name,l]),b=jspreadsheet.getColumnNameFromId([col_name.test_result_id,l]);""!==n?(e.jexcel.setValue(u,""),e.jexcel.setValue(p,""),e.jexcel.setValue(h,""),e.jexcel.setValue(g,""),e.jexcel.setValue(b,""),code=getTest(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_id,l]),code),line_list_table_new.setComments(letter_col_name.test_name+_,""),line_list_table_new.setReadOnly(u,!1),line_list_table_new.setReadOnly(p,!1),line_list_table_new.setReadOnly(h,!1),line_list_table_new.setReadOnly(g,!1)):(e.jexcel.setValue(u,""),e.jexcel.setValue(p,""),e.jexcel.setValue(h,""),e.jexcel.setValue(g,""),line_list_table_new.setReadOnly(u,!0),line_list_table_new.setReadOnly(p,!0),line_list_table_new.setReadOnly(h,!0),line_list_table_new.setReadOnly(g,!0))}if(a==col_name.machine_name&&""!==n&&line_list_table_new.setComments(letter_col_name.machine_name+_,""),a==col_name.test_result&&""!==n){var f=getTestResultId(n,line_list_table_new.getValueFromCoords(col_name.test_id,l));e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_result_id,l]),f),line_list_table_new.setComments(letter_col_name.test_result+_,"")}if(col_name.test_result_date,a==col_name.perform_by&&""!==n&&(code=getPerformer(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.performer_by_id,l]),code),line_list_table_new.setComments(letter_col_name.perform_by+_,"")),a==col_name.nationality&&""!==n&&(code=getNationality(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality_id,l]),code),line_list_table_new.setComments(letter_col_name.nationality+_,"")),a==col_name.is_positive_covid){var v=jspreadsheet.getColumnNameFromId([col_name.test_date,l]);n?line_list_table_new.setReadOnly(v,!1):(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),""),line_list_table_new.setReadOnly(v,!0))}a==col_name.test_date&&n&&line_list_table_new.setComments(letter_col_name.test_date+_,""),a==col_name.vaccination_status&&""!==n&&(status=getVaccinationStatus(n),1==status||""==status?(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),""),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!0),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!0),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status)):2==status?(line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),""),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),""),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),""),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!0)):3==status?(line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),""),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),""),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!0)):4==status?(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!1)):5==status&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.forth_vaccinated_date,l]),!1),line_list_table_new.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_name,l]),!1)),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status)),a==col_name.vaccine_name&&(""!==n?(status=getVaccineCode(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_id,l]),status)):e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_id,l]),"")),a==col_name.second_vaccine_name&&(""!==n?(status=getVaccineCode(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_id,l]),status)):e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_id,l]),"")),a==col_name.third_vaccine_name&&(""!==n?(status=getVaccineCode(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_id,l]),status)):e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_id,l]),""))},oncreateeditor:function(e,t,a,l){if(a==col_name.phone||a==col_name.age||a==col_name.patient_name||a==col_name.patient_code||a==col_name.residence||a==col_name.sample_source||a==col_name.diagnosis||a==col_name.completed_by||a==col_name.phone_completed_by||a==col_name.sample_collector||a==col_name.phone_number_sample_collctor||a==col_name.passport_number||a==col_name.flight_number||a==col_name.seat_number||a==col_name.country||a==col_name.occupation){var n=e.jexcel.options.columns[a].maxlength;t.children[0].setAttribute("maxlength",n)}}});line_list_table_new.hideColumn(col_name.payment_type),line_list_table_new.hideColumn(col_name.admission_date),line_list_table_new.hideColumn(col_name.is_urgent),line_list_table_new.hideColumn(col_name.sex_id),line_list_table_new.hideColumn(col_name.test_id),line_list_table_new.hideColumn(col_name.country_id),line_list_table_new.hideColumn(col_name.nationality_id),line_list_table_new.hideColumn(col_name.performer_by_id),line_list_table_new.hideColumn(col_name.province_code),line_list_table_new.hideColumn(col_name.district_code),line_list_table_new.hideColumn(col_name.commune_code),line_list_table_new.hideColumn(col_name.village_code),line_list_table_new.hideColumn(col_name.reason_for_testing_id),line_list_table_new.hideColumn(col_name.sample_source_id),line_list_table_new.hideColumn(col_name.requester_id),line_list_table_new.hideColumn(col_name.clinical_symtop_id),line_list_table_new.hideColumn(col_name.test_result_id),line_list_table_new.hideColumn(col_name.is_camlis_patient),line_list_table_new.hideColumn(col_name.vaccine_id),line_list_table_new.hideColumn(col_name.vaccination_status_code),line_list_table_new.hideColumn(col_name.second_vaccine_id),line_list_table_new.hideColumn(col_name.third_vaccine_id);var $modal_list_error=$("#modal_error_line_list_new");$("#btnSaveListNew").on("click",function(evt){$(this).addClass("disabled btn-progress"),myDialog.showProgress("show",{text:msg_loading});var line_list_data=line_list_table_new.getData(),data=[],require_string="",valid_check=0,array_check=[],currentDate=new Date;for(var i in line_list_data){var name=line_list_data[i][col_name.patient_name],namelenght=name.length,check_name=!1;if(""!==name.trim()){1!==valid_check&&(valid_check=1);var age=line_list_data[i][col_name.age],check_age=!1;if(require_string+="<tr>",require_string+="<td>"+line_list_data[i][col_name.patient_code]+"</td>",name.length>60?require_string+='<td class="text-danger">'+msg.not_greater_than_60+"</td>":(require_string+="<td>"+name+"</td>",check_name=!0),""==age)require_string+='<td class="text-danger">'+msg.not_fill+"</td>";else if(age.length>3)require_string+='<td class="text-danger">'+msg.not_greater_than_3+"</td>";else{var c=String(age).substr(age.length-1,age.length),patternNumber=/^\d+$/,isNumber=patternNumber.test(c);if(0==isNumber){var c_arr=["m","M","d","D"];if("-1"==c_arr.indexOf(c))require_string+='<td class="text-danger">'+msg.not_correct_format+"</td>";else if(1==age.length)require_string+='<td class="text-danger">'+msg.not_correct_format+"</td>";else{var nb=age.substr(0,age.length-1);nb=parseInt(nb),"m"==c||"M"==c?nb>12?require_string+='<td class="text-danger">'+msg.month_not_greater_than_12+"/td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_age=!0):"d"!=c&&"D"!=c||(nb>31?require_string+='<td class="text-danger">'+msg.day_not_greater_than_31+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_age=!0))}}else{var pattern=/^\d+$/,r=pattern.test(age);0==r?require_string+='<td class="text-danger">លេខឡាតាំងតែប៉ុណ្ណោះ</td>':(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_age=!0)}}var gender=line_list_data[i][col_name.gender],check_gender=!1,gender_id=line_list_data[i][col_name.sex_id];if(0==gender.length||0==gender_id.length)require_string+='<td class="text-danger">'+msg.not_select+"</td>";else{require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>';var check_gender=!0}var phone=line_list_data[i][col_name.phone],check_phone=!1;null!==phone&&phone.length>100?require_string+='<td class="text-danger">'+msg.not_greater_than_100+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_phone=!0);var province=null==line_list_data[i][col_name.province]||null==line_list_data[i][col_name.province]?"":line_list_data[i][col_name.province],check_province=!1,province_id=null==line_list_data[i][col_name.province_code]||null==line_list_data[i][col_name.province_code]?"":line_list_data[i][col_name.province_code];0==province.length||0==province_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_province=!0);var district=null==line_list_data[i][col_name.district]||null==line_list_data[i][col_name.district]?"":line_list_data[i][col_name.district],check_district=!1,district_id=null==line_list_data[i][col_name.district_code]||null==line_list_data[i][col_name.district_code]?"":line_list_data[i][col_name.district_code];0==district.length||0==district_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_district=!0);var commune=null==line_list_data[i][col_name.commune]||null==line_list_data[i][col_name.commune]?"":line_list_data[i][col_name.commune],check_commune=!1,commune_id=null==line_list_data[i][col_name.commune_code]||null==line_list_data[i][col_name.commune_code]?"":line_list_data[i][col_name.commune_code];0==commune.length||0==commune_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_commune=!0);var village=null==line_list_data[i][col_name.village]||null==line_list_data[i][col_name.village]?"":line_list_data[i][col_name.village],check_village=!1,village_id=null==line_list_data[i][col_name.village_code]||null==line_list_data[i][col_name.village_code]?"":line_list_data[i][col_name.village_code];0==village.length||0==village_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_village=!0);var sample_source=line_list_data[i][col_name.sample_source],check_sample_source=!1,sample_source_id=line_list_data[i][col_name.sample_source_id];0==sample_source.length||0==sample_source_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(check_sample_source=!0,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>');var requester=line_list_data[i][col_name.requester],check_requester=!1,requester_id=line_list_data[i][col_name.requester_id];0==requester.length||0==requester_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_requester=!0);var collection_date=line_list_data[i][col_name.collected_date],check_collection_date=!1;""==collection_date?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_collection_date=!0);var recieved_date=line_list_data[i][col_name.received_date],check_recieved_date=!1;if(""==recieved_date)require_string+='<td class="text-danger">'+msg.not_select+"</td>";else{var d1=new Date(recieved_date),d2=new Date(collection_date);d1.getTime()<d2.getTime()?require_string+='<td class="text-danger">'+msg.greater_or_equal_collected_date+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_recieved_date=!0)}var test_name=line_list_data[i][col_name.test_name],check_test_result=!1,check_test_result_date=!1,check_perform_by=!1;if(test_name.length>0){require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0;var test_result=line_list_data[i][col_name.test_result],test_result_id=line_list_data[i][col_name.test_result_id],test_result_date=line_list_data[i][col_name.test_result_date];check_test_result_date=!1;var perform_by=line_list_data[i][col_name.perform_by],perform_by_id=line_list_data[i][col_name.performer_by_id];check_perform_by=!1,0!=test_result.length||""!=test_result_date||0!=perform_by.length&&0!=perform_by_id.length?test_result.length>0&&""==test_result_date&&(0==perform_by.length||0==perform_by_id.length)?(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result_date=!1,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_perform_by=!1):0!=test_result.length||""===test_result_date||0!=perform_by.length&&0!=perform_by_id.length?0==test_result.length&&""==test_result_date&&(perform_by.length>0||perform_by_id.length>0)?(require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result=!1,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result_date=!1,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):test_result.length>0&&""!==test_result_date&&(0==perform_by.length||0==perform_by_id.length)?(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,tr_date=new Date(test_result_date),tr_date>currentDate?(require_string+='<td class="text-danger">'+msg.not_greater_than_current_date+"</td>",check_test_result_date=!1):(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0),require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_perform_by=!1):test_result.length>0&&""==test_result_date&&(perform_by.length>0||perform_by_id.length>0)?(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result_date=!1,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):0==test_result.length&&""!==test_result_date&&(perform_by.length>0||perform_by_id.length>0)?(require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result=!1,tr_date=new Date(test_result_date),tr_date>currentDate?(require_string+='<td class="text-danger">'+msg.not_greater_than_current_date+"</td>",check_test_result_date=!1):(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0),require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,tr_date=new Date(test_result_date),tr_date>currentDate?(require_string+='<td class="text-danger">'+msg.not_greater_than_current_date+"</td>",check_test_result_date=!1):(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0),require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):(require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result=!1,tr_date=new Date(test_result_date),tr_date>currentDate?(require_string+='<td class="text-danger">'+msg.not_greater_than_current_date+"</td>",check_test_result_date=!1):(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0),require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_perform_by=!1):(require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",check_test_result=!0,check_test_result_date=!0,check_perform_by=!0)}else require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",check_test_result=!0,check_test_result_date=!0,check_perform_by=!0;var extraErrString="",extraErrCheck=!0,residence=line_list_data[i][col_name.residence];""!==residence&&(residence=residence.toString(),residence.lenth>100&&(extraErrString+=" - "+label_residence+': <span class="text-danger">'+msg.not_greater_than+" 100 "+msg.char+"</span><br />",extraErrCheck=!1));var contacted_with=line_list_data[i][col_name.is_contacted_with];""!==contacted_with&&(contacted_with=contacted_with.toString(),contacted_with.lenth>50&&(extraErrString+=" - "+label_contact_with+': <span class="text-danger">'+msg.not_greater_than+" 50 "+msg.char+"</span><br />",extraErrCheck=!1));var sample_number=line_list_data[i][col_name.sample_number];""!==sample_number&&(sample_number=sample_number.toString(),sample_number.length>11&&(extraErrString+=" - "+label_sample_number+': <span class="text-danger">'+msg.not_greater_than+" 11 "+msg.char+"</span><br />",extraErrCheck=!1));var clinical_history=line_list_data[i][col_name.diagnosis];""!==clinical_history&&(clinical_history=clinical_history.toString(),clinical_history.length>100&&(extraErrString+=" - "+label_clinical_history+': <span class="text-danger">'+msg.not_greater_than+" 100 "+msg.char+"</span><br />",extraErrCheck=!1));var completed_by=line_list_data[i][col_name.completed_by];""!==completed_by&&(completed_by=completed_by.toString(),completed_by.length>150&&(extraErrString+=" - "+label_completed_by+': <span class="text-danger">'+msg.not_greater_than+" 150 "+msg.char+"</span><br />",extraErrCheck=!1));var phone=line_list_data[i][col_name.phone_completed_by];""!==phone&&(phone=phone.toString(),phone.length>150&&(extraErrString+=" - "+label_phone+': <span class="text-danger">'+msg.not_greater_than+" 150 "+msg.char+"</span><br />",extraErrCheck=!1));var sample_collector=line_list_data[i][col_name.sample_collector];""!==sample_collector&&(sample_collector=sample_collector.toString(),sample_collector.length>50&&(extraErrString+=" - "+label_sample_collector+': <span class="text-danger">'+msg.not_greater_than+" 50 "+msg.char+"</span><br />",extraErrCheck=!1));var phone_number_sample_collctor=line_list_data[i][col_name.phone_number_sample_collctor];""!==phone_number_sample_collctor&&(phone_number_sample_collctor=phone_number_sample_collctor.toString(),phone_number_sample_collctor.length>15&&(extraErrString+=" - "+label_phone+': <span class="text-danger">'+msg.not_greater_than+" 15 "+msg.char+"</span><br />",extraErrCheck=!1));var arrival_date=line_list_data[i][col_name.arrival_date],arrival_date=new Date(arrival_date);""!==arrival_date&&arrival_date>currentDate&&(extraErrString+=" - "+label_date_of_arrival+': <span class="text-danger">'+msg.not_greater_than_current_date+"</span><br />",extraErrCheck=!1);var passport_number=line_list_data[i][col_name.passport_number];""!==passport_number&&(passport_number=passport_number.toString(),passport_number.length>20&&(extraErrString+=" - "+label_passport_no+': <span class="text-danger">'+msg.not_greater_than+" 20 "+msg.char+"</span><br />",extraErrCheck=!1));var flight_number=line_list_data[i][col_name.flight_number];""!==flight_number&&(flight_number=flight_number.toString(),flight_number.length>20&&(extraErrString+=" - "+label_flight_number+': <span class="text-danger">'+msg.not_greater_than+" 20 "+msg.char+"</span><br />",extraErrCheck=!1));var seat_number=line_list_data[i][col_name.seat_number];""!==seat_number&&(seat_number=seat_number.toString(),seat_number.length>5&&(extraErrString+=" - "+label_seat_no+': <span class="text-danger">'+msg.not_greater_than+" 5 "+msg.char+"</span><br />",extraErrCheck=!1));var test_covid_date=line_list_data[i][col_name.test_date],test_covid_date=new Date(test_covid_date);""!==test_covid_date&&test_covid_date>currentDate&&(extraErrString+=" - "+label_test_covid_date+': <span class="text-danger">'+msg.not_greater_than_current_date+"</span><br />",extraErrCheck=!1);var reason_for_testing_id=line_list_data[i][col_name.reason_for_testing_id],reason_for_testing=line_list_data[i][col_name.reason_for_testing];""!=reason_for_testing&&0!=reason_for_testing_id||(extraErrString+=" - "+label_reason_for_testing+': <span class="text-danger">'+msg.not_select+"</span><br />",extraErrCheck=!1);var country_name=line_list_data[i][col_name.country];""!==country_name&&(country_name=country_name.toString(),country_name.length>150&&(extraErrString+=" - "+label_country+': <span class="text-danger">'+msg.not_greater_than+" 150 "+msg.char+"</span><br />",extraErrCheck=!1)),require_string+="<td>"+extraErrString+" &nbsp;</td>",require_string+="</tr>",check_age&&check_name&&check_gender&&check_province&&check_district&&check_commune&&check_village&&check_phone&&check_sample_source&&check_requester&&check_collection_date&&check_recieved_date&&check_test_result&&check_test_result_date&&check_perform_by&&extraErrCheck?(patient_code=line_list_data[i][col_name.patient_code],patient_code=patient_code.toString(),line_list_data[i][col_name.patient_code]=patient_code.trim(),age=line_list_data[i][col_name.age],phone=line_list_data[i][col_name.phone],phone=phone.toString(),line_list_data[i][col_name.phone]=phone.trim(),residence=line_list_data[i][col_name.residence],residence=residence.toString(),line_list_data[i][col_name.residence]=residence.trim(),is_contacted_with=line_list_data[i][col_name.is_contacted_with],line_list_data[i][col_name.is_contacted_with]=is_contacted_with.trim(),sample_number=line_list_data[i][col_name.sample_number],sample_number=sample_number.toString(),line_list_data[i][col_name.sample_number]=sample_number.trim(),line_list_data[i][col_name.sample_source]=sample_source,line_list_data[i][col_name.requester]=requester,diagnosis=line_list_data[i][col_name.diagnosis],diagnosis=diagnosis.toString(),line_list_data[i][col_name.diagnosis]=diagnosis.trim(),completed_by=line_list_data[i][col_name.completed_by],line_list_data[i][col_name.completed_by]=completed_by.trim(),phone_completed_by=line_list_data[i][col_name.phone_completed_by],phone_completed_by=phone_completed_by.toString(),line_list_data[i][col_name.phone_completed_by]=phone_completed_by.trim(),sample_collector=line_list_data[i][col_name.sample_collector],line_list_data[i][col_name.sample_collector]=sample_collector.trim(),phone_number_sample_collctor=line_list_data[i][col_name.phone_number_sample_collctor],phone_number_sample_collctor=phone_number_sample_collctor.toString(),line_list_data[i][col_name.phone_number_sample_collctor]=phone_number_sample_collctor.trim(),passport_number=line_list_data[i][col_name.passport_number],passport_number=passport_number.toString(),line_list_data[i][col_name.passport_number]=passport_number.trim(),flight_number=line_list_data[i][col_name.flight_number],flight_number=flight_number.toString(),line_list_data[i][col_name.flight_number]=flight_number.trim(),seat_number=line_list_data[i][col_name.seat_number],seat_number=seat_number.toString(),line_list_data[i][col_name.seat_number]=seat_number.trim(),contact_with=line_list_data[i][col_name.is_contacted_with],contact_with=contact_with.toString(),line_list_data[i][col_name.is_contacted_with]=contact_with.trim(),completed_by=line_list_data[i][col_name.completed_by],line_list_data[i][col_name.completed_by]=completed_by.trim(),phone_number=line_list_data[i][col_name.phone_completed_by],phone_number=phone_number.toString(),line_list_data[i][col_name.phone_completed_by]=phone_number.trim(),sample_collector=line_list_data[i][col_name.sample_collector],line_list_data[i][col_name.sample_collector]=sample_collector.trim(),phone_number_sample_collector=line_list_data[i][col_name.phone_number_sample_collctor],phone_number_sample_collector=phone_number_sample_collector.toString(),line_list_data[i][col_name.phone_number_sample_collctor]=phone_number_sample_collector.trim(),data.push(line_list_data[i]),array_check.push(!0)):array_check.push(!1)}}return 0==valid_check?(myDialog.showProgress("hide"),myDialog.showDialog("show",{text:msg.not_data_entry,style:"warning"}),$(this).removeClass("disabled"),!1):(console.log("Check "+array_check.indexOf(!1)),array_check.indexOf(!1)>=0?(myDialog.showProgress("hide"),$("table[name=tblErrorLineListNew] tbody").html(require_string),$modal_list_error.modal("show"),$(this).removeClass("disabled"),!1):data.length>500?(myDialog.showProgress("hide"),myDialog.showDialog("show",{text:msg.not_greater_than_100_row,style:"warning"}),$(this).removeClass("disabled"),!1):void $.ajax({url:base_url+"/patient/add_line_list_full_form",type:"POST",data:{data:data},dataType:"json",success:function(e){var t=e.patients,a="",l="",n=1,_="";if(console.log(e),null==e.status||e.status){for(var s in console.log(e.execution_time),t){var i="",o="";void 0!==t[s].psample_id&&(i='<button type="button" class="btn btn-sm btn-success btnPrintCovidFormV1" data-psample_id="'+t[s].psample_id+'" title="'+label_print_lab_form+'"><i class="fa fa-eye"></i></button>',l+=t[s].psample_id+"n"),void 0!==t[s].test_result_msg&&(o=t[s].test_result_msg),a+="<tr>",a+="<td>"+n+"</td>",a+="<td>"+t[s].patient_code+"</td>",a+="<td>"+t[s].patient_name+"</td>",a+="<td>"+t[s].msg+"</td>",a+="<td>"+t[s].sample_number+"</td>",a+="<td>"+t[s].sample_msg+"</td>",a+="<td>"+t[s].test_msg+"</td>",a+="<td>"+o+"</td>",a+="<td>"+i+"</td>",a+="</tr>",_+='<tr data-patient_code="'+t[s].patient_code+'">',_+='<td style="text-align:center; vertical-align:middle;"></td>',_+='<td style="text-align:center; vertical-align:middle;"><span>'+t[s].patient_code+"</span></td>",_+="</tr>",n++}setTimeout(function(){myDialog.showProgress("hide"),$("table[name=tblResultLineListNew] tbody").html(a);var e=l.substring(0,l.length-1);$("#printAll").attr("data-psample_id",e),$("#modal_result_line_list_new").modal("show"),$("table[name=tbl_qr_code] tbody").html(_);var n=Object.keys(col_name).length;for(r=0;r<t.length;r++)for(c=0;c<n;c++)line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([c,r]),"");$("#btnSaveListNew").removeClass("disabled")},1e3)}else a+='<tr><td colspan="9">',a+=e.msg,a+="<td></tr>",setTimeout(function(){myDialog.showProgress("hide"),$("table[name=tblResultLineListNew] tbody").html(a),$("#modal_result_line_list_new").modal("show")},1e3)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");console.log(err.Message),console.log(xhr.responseText)}}))});var $modal_excel_short_form=$("#modal_excel_short_form");$("#btnExcelShortForm").on("click",function(e){$modal_excel_short_form.modal("show")}),$("select[name=clinical_symptom]").select2(),$("select[name=sample_source]").on("change",function(e){e.preventDefault();$(this).parents("form.frm-sample-entry");var t=$("select[name=requester]"),a=$(this).val();if(a<=0)return!1;$.ajax({url:base_url+"requester/get_lab_requester",type:"POST",data:{sample_source_id:a},dataType:"json",async:!1,success:function(e){if(e.requesters.length>0)for(var a in e.requesters){var l="<option value='"+e.requesters[a].requester_id+"' >"+e.requesters[a].requester_name+"</option>";t.append(l)}},error:function(e){}})}),$("input[name=collected_date].dtpicker , input[name=received_date].dtpicker").datetimepicker(dtPickerOption),$("input.coltimepicker").timepicker({minuteStep:1,showMeridian:!1,defaultTime:moment().subtract(1,"minutes").format("HH:mm")}),$("input.rectimepicker").timepicker({minuteStep:1,showMeridian:!1}),$modal_excel_short_form.find('input:checkbox[name="is_contacted"]').on("click",function(e){$(this).is(":checked")?$modal_excel_short_form.find("div.contact_wrapper").removeClass("hidden"):$modal_excel_short_form.find("div.contact_wrapper").addClass("hidden")});var line_list_table_short_form=jspreadsheet(document.getElementById("excelShortForm"),{data:data_tmp,minDimensions:[24,maxRow],defaultColWidth:100,tableOverflow:!0,tableHeight:"350px",columns:[{type:"text",title:label_patient_id,width:140,maxlength:20},{type:"text",title:label_patient_name+"*",maxlength:60},{type:"numeric",title:label_patient_age+"*",width:40,maxlength:3},{type:"dropdown",title:label_sex+"*",width:60,source:gender_array},{type:"text",title:label_patient_phone_number,maxlength:100},{type:"autocomplete",title:label_province+"*",width:100,source:province_array},{type:"autocomplete",title:label_district+"*",width:100,source:districts_array,filter:districtFilter2},{type:"autocomplete",title:label_commune+"*",width:100,source:communes_array,filter:communeFilter2},{type:"autocomplete",title:label_village+"*",width:100,source:villages_array,filter:villageFilter2},{type:"text",title:label_residence,width:80,maxlength:100},{type:"autocomplete",title:label_reason_for_testing+"*",width:120,source:reason_for_testing_array},{type:"checkbox",title:label_yes,width:100},{type:"text",title:label_contact_with,readOnly:!0,maxlength:60},{type:"checkbox",title:label_is_direct_contact},{type:"text",title:label_sample_number,width:120,maxlength:11},{type:"dropdown",title:label_sample_source+"*",width:100,source:sample_source_array},{type:"dropdown",title:label_requester+"*",width:120,source:requester_array,filter:requesterFilter2},{type:"calendar",title:label_collect_dt+"*",width:170,options:{format:"YYYY-MM-DD",time:!0,readonly:!0,validRange:["2021-01-01",today]}},{type:"calendar",title:label_receive_dt+"*",width:170,options:{format:"YYYY-MM-DD",time:!0,readonly:!0,validRange:["2021-01-01",today]}},{type:"autocomplete",title:label_payment_type+"*",width:120,source:payment_type_array},{type:"calendar",title:"ថ្ងៃចូលសម្រាកពេទ្យ",width:120,options:{format:"YYYY-MM-DD",time:!0,readonly:!0}},{type:"text",title:label_clinical_history,width:80,maxlength:60},{type:"checkbox",title:label_urgent,width:50},{type:"text",title:label_completed_by,width:160,maxlength:50},{type:"text",title:label_phone,maxlength:10},{type:"text",title:label_sample_collector,maxlength:50},{type:"text",title:label_phone,maxlength:10},{type:"dropdown",title:label_clinical_symtom,width:150,source:clinical_symptom_array,autocomplete:!0,multiple:!0},{type:"text",title:label_health_facility,maxlength:150},{type:"dropdown",title:label_test_name,width:150,source:test_name_array},{type:"dropdown",title:label_machine_name,width:150,source:machine_name_array,filter:machineNameFilterShortForm,readOnly:!0},{type:"dropdown",title:label_result,width:70,source:test_result_array,filter:testResultFilterShortForm,readOnly:!0},{type:"calendar",title:label_test_date,width:150,readOnly:!0,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"autocomplete",title:label_performed_by,width:120,source:performer_array,readOnly:!0},{type:"text",title:label_country,width:80,maxlength:150},{type:"autocomplete",title:label_nationality,width:80,source:nationalities_array},{type:"calendar",title:label_date_of_arrival,width:100,options:{format:"YYYY-MM-DD",readonly:!0}},{type:"text",title:label_passport_no,width:80,maxlength:20},{type:"text",title:label_flight_number,maxlength:10},{type:"text",title:label_seat_no,width:60,maxlength:5},{type:"checkbox",title:label_yes,width:60},{type:"calendar",title:label_test_covid_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"text",title:"sex"},{type:"text",title:"province_code"},{type:"text",title:"district_code"},{type:"text",title:"commune_code"},{type:"text",title:"village_code"},{type:"text",title:"reason_for_testing"},{type:"text",title:"sample_source_id"},{type:"text",title:"requester_id"},{type:"text",title:"clinical_symtom_id"},{type:"text",title:"test_id"},{type:"text",title:"country_id"},{type:"text",title:"nationality_id"},{type:"dropdown",title:label_number_of_sample,width:120,source:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]},{type:"text",title:"performer_by_id"},{type:"text",title:"test_result_id"},{type:"text",title:"is_camlis_patient"},{type:"dropdown",title:label_vaccination_status,source:vaccination_status_array},{type:"calendar",title:label_first_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"calendar",title:label_second_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"dropdown",title:label_vaccine_type,source:vaccine_type_array,readOnly:!0,width:90},{type:"calendar",title:label_third_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"dropdown",title:label_vaccine_type,source:vaccine_type_array,readOnly:!0,width:90},{type:"calendar",title:label_forth_injection_date,readOnly:!0,width:90,options:{format:"YYYY-MM-DD",readonly:!0,validRange:["2021-01-01",today]}},{type:"dropdown",title:label_vaccine_type,source:vaccine_type_array,readOnly:!0,width:90},{type:"text",title:label_occupation,maxlength:100},{type:"text",title:"vaccination_status_code"},{type:"text",title:"vaccine_id"},{type:"text",title:"second_vaccine_id"},{type:"text",title:"third_vaccine_id"}],nestedHeaders:[[{title:label_patient_info,colspan:"11"},{title:label_sample_info,colspan:"8"},{title:label_patient_info,colspan:"8"},{title:label_sample_info,colspan:"1"},{title:label_patient_info,colspan:"10"}],[{title:label_patient,colspan:"5"},{title:label_address,colspan:"6"},{title:label_sample,colspan:"4"},{title:label_test_result,colspan:"4"},{title:label_patient_info,colspan:"6"},{title:label_history_of_covid19_history,colspan:"2"},{title:label_sample,colspan:"1"},{title:label_covid_questionaire,colspan:"10"}]],onchange:function(e,t,a,l,n){if(0==a){var _,r=1;if(""!==n){var s=n;$.ajax({url:base_url+"patient/search/"+s,type:"POST",data:{pid:s},dataType:"json",success:function(t){var n=t.patient;if(n){if("kh"==app_language)var s="M"==n.sex?"ប្រុស":"ស្រី",i=n.province_kh,o=n.district_kh,c=n.commune_kh,m=n.village_kh;else s="M"==n.sex?"Male":"Female",i=n.province_en,o=n.district_en,c=n.commune_en,m=n.village_en;var d=moment(n.dob,"YYYY-MM-DD"),u=calculateAge(d),p=null!=n.is_positive_covid&&null!=n.is_positive_covid&&0!=n.is_positive_covid,h=null!=n.is_contacted&&null!=n.is_contacted&&n.is_contacted,g=null==n.contact_with||null==n.contact_with?"":n.contact_with,b=null!=n.is_direct_contact&&null!=n.is_direct_contact&&n.is_direct_contact,f=null==n.test_date||null==n.test_date?"":n.test_date,v=n.name,y=null==n.residence||null==n.residence?"":n.residence,x=null==n.date_arrival||null==n.date_arrival?"":n.date_arrival,C=null==n.country_name_en||null==n.country_name_en?"":n.country_name_en;C=null==n.country_name||null==n.country_name?"":n.country_name;var j=null==n.nationality_en||null==n.nationality_en?"":n.nationality_en,w=null==n.passport_number||null==n.passport_number?"":n.passport_number,I=null==n.flight_number||null==n.flight_number?"":n.flight_number,N=null==n.seat_number||null==n.seat_number?"":n.seat_number,F=null==n.phone||null==n.phone?"":n.phone.trim(),V=null==n.is_camlis_patient?0:1,k=null==n.vaccination_status||null==n.vaccination_status?"":n.vaccination_status,R=null==n.vaccine_id||null==n.vaccine_id?"":n.vaccine_id,S=null==n.first_vaccinated_date||null==n.first_vaccinated_date?"":n.first_vaccinated_date,T=null==n.second_vaccinated_date||null==n.second_vaccinated_date?"":n.second_vaccinated_date,q=null==n.occupation||null==n.occupation?"":n.occupation,$=null==n.second_vaccine_id||null==n.second_vaccine_id?"":n.second_vaccine_id,D=null==n.third_vaccinated_date||null==n.third_vaccinated_date?"":n.third_vaccinated_date,E=null==n.third_vaccine_id||null==n.third_vaccine_id?"":n.third_vaccine_id,O=null==n.forth_vaccinated_date||null==n.forth_vaccinated_date?"":n.forth_vaccinated_date,A=[v,u.years,s,F,i,o,c,m,y];for(_=0;_<9;_++){var M=jspreadsheet.getColumnNameFromId([a+r,l]);e.jexcel.setValue(M,A[_]),r++}if(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,l]),h),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),g),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),b),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.country,l]),C),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,l]),j),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,l]),x),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,l]),w),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,l]),I),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,l]),N),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,l]),p),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),f),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_camlis_patient,l]),V),""!==k){var Y=getVaccinationStatusString(k);e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,l]),Y);var P=getVaccineName(R),L=getVaccineName($);e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),P),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),L),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),S),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),T),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),D);var H=getVaccineName(E);e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_name,l]),H),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.forth_vaccinated_date,l]),O)}e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,l]),q)}else{for(r=1,_=0;_<9;_++){M=jspreadsheet.getColumnNameFromId([a+r,l]);e.jexcel.setValue(M,""),r++}e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.country,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_camlis_patient,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,l]),"")}}})}else{for(r=1,_=0;_<9;_++){var i=jspreadsheet.getColumnNameFromId([a+r,l]);e.jexcel.setValue(i,""),r++}e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.country,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_camlis_patient,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,l]),"")}}if(a==col_name.gender&&""!==n&&("kh"==app_language?sex="ប្រុស"==n?1:2:sex="Male"==n?1:2,e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.sex_id,l]),sex)),a==col_name.province&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.district,l]),""),code=getProvinceCode_(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.province_code,l]),code)),a==col_name.district&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.commune,l]),""),province_code=line_list_table_short_form.getValueFromCoords(col_name.province_code,l),code=getDistrictCode_(n,province_code),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.district_code,l]),code)),a==col_name.commune&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.village,l]),""),district_code=line_list_table_short_form.getValueFromCoords(col_name.district_code,l),code=getCommuneCode_(n,district_code),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.commune_code,l]),code)),a==col_name.village&&""!==n&&(commune_code=line_list_table_short_form.getValueFromCoords(col_name.commune_code,l),code=getVillageCode_(n,commune_code),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.village_code,l]),code)),a==col_name.reason_for_testing&&""!==n&&(code=getReason_(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.reason_for_testing_id,l]),code)),a==col_name.is_contacted){var o=jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),c=jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]);n?(line_list_table_short_form.setReadOnly(o,!1),line_list_table_short_form.setReadOnly(c,!1)):(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,l]),""),line_list_table_short_form.setReadOnly(o,!0),line_list_table_short_form.setReadOnly(c,!0))}if(a==col_name.sample_source&&""!==n&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.requester,l]),""),code=getSampleSource(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.sample_source_id,l]),code)),a==col_name.requester&&""!==n){sample_source_id=line_list_table_short_form.getValueFromCoords(col_name.sample_source_id,l),code=getRequester(n,sample_source_id);var m=jspreadsheet.getColumnNameFromId([col_name.requester_id,l]);e.jexcel.setValue(m,code)}if(a==col_name.clinical_symptom&&""!==n&&(code=getClinicalSymptom_(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.clinical_symtop_id,l]),code)),a==col_name.test_name){var d=jspreadsheet.getColumnNameFromId([col_name.test_result,l]),u=jspreadsheet.getColumnNameFromId([col_name.test_result_date,l]),p=jspreadsheet.getColumnNameFromId([col_name.perform_by,l]),h=jspreadsheet.getColumnNameFromId([col_name.machine_name,l]),g=jspreadsheet.getColumnNameFromId([col_name.test_result_id,l]);""!==n?(e.jexcel.setValue(d,""),e.jexcel.setValue(u,""),e.jexcel.setValue(p,""),e.jexcel.setValue(h,""),e.jexcel.setValue(g,""),code=getTest(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_id,l]),code),line_list_table_short_form.setReadOnly(d,!1),line_list_table_short_form.setReadOnly(u,!1),line_list_table_short_form.setReadOnly(p,!1),line_list_table_short_form.setReadOnly(h,!1)):(e.jexcel.setValue(d,""),e.jexcel.setValue(u,""),e.jexcel.setValue(p,""),e.jexcel.setValue(h,""),line_list_table_short_form.setReadOnly(d,!0),line_list_table_short_form.setReadOnly(u,!0),line_list_table_short_form.setReadOnly(p,!0),line_list_table_short_form.setReadOnly(h,!0))}if(a==col_name.test_result&&""!==n){var b=getTestResultId(n,$modal_excel_short_form.find("select[name=test_name]").val());e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_result_id,l]),b)}if(a==col_name.perform_by&&""!==n&&(code=getPerformer(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.performer_by_id,l]),code)),a==col_name.nationality&&""!==n&&(code=getNationality(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality_id,l]),code)),a==col_name.is_positive_covid){var f=jspreadsheet.getColumnNameFromId([col_name.test_date,l]);n?line_list_table_short_form.setReadOnly(f,!1):(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,l]),""),line_list_table_short_form.setReadOnly(f,!0))}a==col_name.vaccination_status&&""!==n&&(status=getVaccinationStatus(n),console.log(status),1==status||""==status?(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),""),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),""),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!0),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!0),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status)):2==status?(line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),""),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),""),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),""),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!0)):3==status?(line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!1),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),""),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!0),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),""),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!0)):4==status?(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!1)):5==status&&(e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_name,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.forth_vaccinated_date,l]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_name,l]),!1)),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status_code,l]),status)),a==col_name.vaccine_name&&(""!==n?(status=getVaccineCode(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_id,l]),status)):e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_id,l]),"")),a==col_name.second_vaccine_name&&(""!==n?(status=getVaccineCode(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_id,l]),status)):e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccine_id,l]),"")),a==col_name.third_vaccine_name&&(""!==n?(status=getVaccineCode(n),e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_id,l]),status)):e.jexcel.setValue(jspreadsheet.getColumnNameFromId([col_name.third_vaccine_id,l]),""))},oncreateeditor:function(e,t,a,l){if(a==col_name.phone||a==col_name.age||a==col_name.patient_name||a==col_name.patient_code||a==col_name.residence||a==col_name.sample_source||a==col_name.diagnosis||a==col_name.completed_by||a==col_name.phone_completed_by||a==col_name.sample_collector||a==col_name.phone_number_sample_collctor||a==col_name.passport_number||a==col_name.flight_number||a==col_name.seat_number||a==col_name.country||a==col_name.occupation){var n=e.jexcel.options.columns[a].maxlength;t.children[0].setAttribute("maxlength",n)}}});line_list_table_short_form.hideColumn(col_name.payment_type),line_list_table_short_form.hideColumn(col_name.admission_date),line_list_table_short_form.hideColumn(col_name.is_contacted),line_list_table_short_form.hideColumn(col_name.is_contacted_with),line_list_table_short_form.hideColumn(col_name.is_directed_contact),line_list_table_short_form.hideColumn(col_name.sample_source),line_list_table_short_form.hideColumn(col_name.requester),line_list_table_short_form.hideColumn(col_name.collected_date),line_list_table_short_form.hideColumn(col_name.received_date),line_list_table_short_form.hideColumn(col_name.completed_by),line_list_table_short_form.hideColumn(col_name.phone_completed_by),line_list_table_short_form.hideColumn(col_name.sample_collector),line_list_table_short_form.hideColumn(col_name.phone_number_sample_collctor),line_list_table_short_form.hideColumn(col_name.test_name),line_list_table_short_form.hideColumn(col_name.is_urgent),line_list_table_short_form.hideColumn(col_name.sex_id),line_list_table_short_form.hideColumn(col_name.test_id),line_list_table_short_form.hideColumn(col_name.country_id),line_list_table_short_form.hideColumn(col_name.nationality_id),line_list_table_short_form.hideColumn(col_name.performer_by_id),line_list_table_short_form.hideColumn(col_name.province_code),line_list_table_short_form.hideColumn(col_name.district_code),line_list_table_short_form.hideColumn(col_name.commune_code),line_list_table_short_form.hideColumn(col_name.village_code),line_list_table_short_form.hideColumn(col_name.reason_for_testing_id),line_list_table_short_form.hideColumn(col_name.sample_source_id),line_list_table_short_form.hideColumn(col_name.requester_id),line_list_table_short_form.hideColumn(col_name.clinical_symtop_id),line_list_table_short_form.hideColumn(col_name.test_result_id),line_list_table_short_form.hideColumn(col_name.is_camlis_patient),line_list_table_short_form.hideColumn(col_name.vaccination_status_code),line_list_table_short_form.hideColumn(col_name.vaccine_id),line_list_table_short_form.hideColumn(col_name.second_vaccine_id),line_list_table_short_form.hideColumn(col_name.third_vaccine_id),$("#btnSaveListShorFormTest").on("click",function(evt){$(this).addClass("disabled"),$modal_excel_short_form.find('input:checkbox[name="is_contacted"]').val();var sample_source_id=$modal_excel_short_form.find("select[name=sample_source]").val(),sample_source=$modal_excel_short_form.find("select[name=sample_source] option:selected").text(),requester_id=$modal_excel_short_form.find("select[name=requester]").val(),requester=$modal_excel_short_form.find("select[name=requester] option:selected").text(),collected_date=$modal_excel_short_form.find("input[name=collected_date]").data("DateTimePicker").date(),received_date=$modal_excel_short_form.find("input[name=received_date]").data("DateTimePicker").date(),collected_time=moment($modal_excel_short_form.find("input[name=collected_time]").val().trim(),"HH:mm"),received_time=moment($modal_excel_short_form.find("input[name=received_time]").val().trim(),"HH:mm"),test_id=$modal_excel_short_form.find("select[name=test_name]").val(),test_name=$modal_excel_short_form.find("select[name=test_name] option:selected").text(),completed_by=$modal_excel_short_form.find("input[name=completed_by]").val(),phone_number=$modal_excel_short_form.find("input[name=phone_number]").val(),sample_collector=$modal_excel_short_form.find("input[name=sample_collector]").val(),phone_number_sample_collector=$modal_excel_short_form.find("input[name=phone_number_sample_collector]").val(),is_contacted=!!$modal_excel_short_form.find("#is_contacted").is(":checked"),contact_with=$modal_excel_short_form.find("input[name=contact_with]").val(),is_direct_contact=$modal_excel_short_form.find("input[name=is_direct_contact]:checked").val();if(null!==collected_date&&collected_time._i.length>0)var collected_date_time=moment(collected_date.format("YYYY-MM-DD")+" "+collected_time.format("HH:mm:ss"),"YYYY-MM-DD HH:mm:ss");if(null!==received_date&&received_time._i.length>0)var received_date_time=moment(received_date.format("YYYY-MM-DD")+" "+received_time.format("HH:mm:ss"),"YYYY-MM-DD HH:mm:ss");var currentDate=new Date,is_valid=!1;if(is_valid="-1"!=sample_source_id&&("-1"!=requester_id&&(null!=collected_date&&null!=received_date)),!is_valid)return myDialog.showDialog("show",{text:msg_required_data,style:"warning"}),$(this).removeClass("disabled"),!1;if(collected_date_time>received_date_time)return myDialog.showDialog("show",{text:msg_col_rec_dt_error,style:"warning"}),$(this).removeClass("disabled"),!1;myDialog.showProgress("show",{text:msg_loading});var line_list_data=line_list_table_short_form.getData(),data=[],require_string="",valid_check=0,array_check=[];for(var i in line_list_data){var name=line_list_data[i][col_name.patient_name],name=name.trim();if(""!==name||name.length>0){1!==valid_check&&(valid_check=1);var age=line_list_data[i][col_name.age],check_age=!1;if(require_string+="<tr>",require_string+="<td>"+line_list_data[i][col_name.patient_code]+"</td>",name.length>60?require_string+='<td class="text-danger">'+msg.not_greater_than_60+"</td>":(require_string+="<td>"+name+"</td>",check_name=!0),""==age)require_string+='<td class="text-danger">'+msg.not_fill+"</td>";else if(age.length>3)require_string+='<td class="text-danger">'+msg.not_greater_than_3+"</td>";else{var c=String(age).substr(age.length-1,age.length),patternNumber=/^\d+$/,isNumber=patternNumber.test(c);if(0==isNumber){var c_arr=["m","M","d","D"];if("-1"==c_arr.indexOf(c))require_string+='<td class="text-danger">'+msg.not_correct_format+"</td>";else if(1==age.length)require_string+='<td class="text-danger">'+msg.not_correct_format+"</td>";else{var nb=age.substr(0,age.length-1);nb=parseInt(nb),"m"==c||"M"==c?nb>12?require_string+='<td class="text-danger">'+msg.month_not_greater_than_12+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_age=!0):"d"!=c&&"D"!=c||(nb>31?require_string+='<td class="text-danger">'+msg.day_not_greater_than_31+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_age=!0))}}else{var pattern=/^\d+$/,r=pattern.test(age);0==r?require_string+='<td class="text-danger">'+msg.not_correct_format+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_age=!0)}}var gender=line_list_data[i][col_name.gender],check_gender=!1,gender_id=line_list_data[i][col_name.sex_id];if(0==gender.length||0==gender_id.length)require_string+='<td class="text-danger">'+msg.not_select+"</td>";else{require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>';var check_gender=!0}var phone=line_list_data[i][col_name.phone],check_phone=!1;null!==phone&&phone.length>100?require_string+='<td class="text-danger">'+msg.not_greater_than_100+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_phone=!0);var province=line_list_data[i][col_name.province],check_province=!1,province_id=line_list_data[i][col_name.province_code];0==province.length||0==province_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_province=!0);var district=line_list_data[i][col_name.district],check_district=!1,district_id=line_list_data[i][col_name.district_code];0==district.length||0==district_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_district=!0);var commune=line_list_data[i][col_name.commune],check_commune=!1,commune_id=line_list_data[i][col_name.commune_code];0==commune.length||0==commune_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_commune=!0);var village=line_list_data[i][col_name.village],check_village=!1,village_id=line_list_data[i][col_name.village_code];0==village.length||0==village_id.length?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_village=!0);var check_sample_source=!1;"-1"==sample_source_id?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(check_sample_source=!0,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>');var check_requester=!1;"-1"==requester_id?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_requester=!0);var check_collection_date=!1;null==collected_date?require_string+='<td class="text-danger">'+msg.not_select+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_collection_date=!0);var check_recieved_date=!1;null==received_date?require_string+='<td class="text-danger">'+msg.not_select+"</td>":collected_date_time>received_date_time?require_string+='<td class="text-danger">'+msg_col_rec_dt_error+"</td>":(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_recieved_date=!0);var check_test_result=!1,check_test_result_date=!1,check_perform_by=!1;if(test_name.length>0){require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0;var test_result=line_list_data[i][col_name.test_result],test_result_date=line_list_data[i][col_name.test_result_date];check_test_result_date=!1;var perform_by=line_list_data[i][col_name.perform_by],perform_by_id=line_list_data[i][col_name.performer_by_id];check_perform_by=!1,0!=test_result.length||""!=test_result_date||0!=perform_by.length&&0!=perform_by_id.length?test_result.length>0&&""==test_result_date&&(0==perform_by.length||0==perform_by_id.length)?(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result_date=!1,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_perform_by=!1):0!=test_result.length||""===test_result_date||0!=perform_by.length&&0!=perform_by_id.length?0==test_result.length&&""==test_result_date&&(perform_by.length>0||perform_by_id.length>0)?(require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result=!1,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result_date=!1,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):test_result.length>0&&""!==test_result_date&&(0==perform_by.length||0==perform_by_id.length)?(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_perform_by=!1):test_result.length>0&&""==test_result_date&&(perform_by.length>0||perform_by_id.length>0)?(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result_date=!1,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):0==test_result.length&&""!==test_result_date&&(perform_by.length>0||perform_by_id.length>0)?(require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result=!1,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):(require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result=!0,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_perform_by=!0):(require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_test_result=!1,require_string+='<td><i class="fa fa-check-circle" aria-hidden="true" style="color:blue;"></i></td>',check_test_result_date=!0,require_string+='<td class="text-danger">'+msg.not_select+"</td>",check_perform_by=!1):(require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",check_test_result=!0,check_test_result_date=!0,check_perform_by=!0)}else require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",require_string+="<td>&nbsp;</td>",check_test_result=!0,check_test_result_date=!0,check_perform_by=!0;var extraErrString="",extraErrCheck=!0,residence=line_list_data[i][col_name.residence];""!==residence&&(residence=residence.toString(),residence.lenth>100&&(extraErrString+=" - "+label_residence+': <span class="text-danger">'+msg.not_greater_than+" 100 "+msg.char+"</span><br />",extraErrCheck=!1));var sample_number=line_list_data[i][col_name.sample_number];""!==sample_number&&(sample_number=sample_number.toString(),sample_number.length>11&&(extraErrString+=" - "+label_sample_number+': <span class="text-danger">'+msg.not_greater_than+" 11 "+msg.char+"</span><br />",extraErrCheck=!1));var clinical_history=line_list_data[i][col_name.diagnosis];""!==clinical_history&&(clinical_history=clinical_history.toString(),clinical_history.length>100&&(extraErrString+=" - "+label_clinical_history+': <span class="text-danger">'+msg.not_greater_than+" 100 "+msg.char+"</span><br />",extraErrCheck=!1));var arrival_date=line_list_data[i][col_name.arrival_date],arrival_date=new Date(arrival_date);""!==arrival_date&&arrival_date>currentDate&&(extraErrString+=" - "+label_date_of_arrival+': <span class="text-danger">'+msg.not_greater_than_current_date+"</span><br />",extraErrCheck=!1);var passport_number=line_list_data[i][col_name.passport_number];""!==passport_number&&(passport_number=passport_number.toString(),passport_number.length>20&&(extraErrString+=" - "+label_passport_no+': <span class="text-danger">'+msg.not_greater_than+" 20 "+msg.char+"</span><br />",extraErrCheck=!1));var flight_number=line_list_data[i][col_name.flight_number];""!==flight_number&&(flight_number=flight_number.toString(),flight_number.length>20&&(extraErrString+=" - "+label_flight_number+': <span class="text-danger">'+msg.not_greater_than+" 20 "+msg.char+"</span><br />",extraErrCheck=!1));var seat_number=line_list_data[i][col_name.seat_number];""!==seat_number&&(seat_number=seat_number.toString(),seat_number.length>5&&(extraErrString+=" - "+label_seat_no+': <span class="text-danger">'+msg.not_greater_than+" 5 "+msg.char+"</span><br />",extraErrCheck=!1));var test_covid_date=line_list_data[i][col_name.test_date],test_covid_date=new Date(test_covid_date);""!==test_covid_date&&test_covid_date>currentDate&&(extraErrString+=" - "+label_test_covid_date+': <span class="text-danger">'+msg.not_greater_than_current_date+"</span><br />",extraErrCheck=!1);var reason_for_testing_id=line_list_data[i][col_name.reason_for_testing_id],reason_for_testing=line_list_data[i][col_name.reason_for_testing];""!=reason_for_testing&&0!=reason_for_testing_id||(extraErrString+=" - "+label_reason_for_testing+': <span class="text-danger">'+msg.not_select+"</span><br />",extraErrCheck=!1);var country_name=line_list_data[i][col_name.country];""!==country_name&&(country_name=country_name.toString(),country_name.length>150&&(extraErrString+=" - "+label_country+': <span class="text-danger">'+msg.not_greater_than+" 150 "+msg.char+"</span><br />",extraErrCheck=!1)),require_string+="<td>"+extraErrString+" &nbsp;</td>",require_string+="</tr>",check_age&&check_gender&&check_province&&check_district&&check_commune&&check_village&&check_phone&&check_sample_source&&check_requester&&check_collection_date&&check_recieved_date&&check_test_result&&check_test_result_date&&check_perform_by&&extraErrCheck?(patient_code=line_list_data[i][col_name.patient_code],patient_code=patient_code.toString(),line_list_data[i][col_name.patient_code]=patient_code.trim(),age=line_list_data[i][col_name.age],phone=line_list_data[i][col_name.phone],phone=phone.toString(),line_list_data[i][col_name.phone]=phone.trim(),residence=line_list_data[i][col_name.residence],residence=residence.toString(),line_list_data[i][col_name.residence]=residence.trim(),is_contacted_with=line_list_data[i][col_name.is_contacted_with],line_list_data[i][col_name.is_contacted_with]=is_contacted_with.trim(),sample_number=line_list_data[i][col_name.sample_number],sample_number=sample_number.toString(),line_list_data[i][col_name.sample_number]=sample_number.trim(),line_list_data[i][col_name.sample_source]=sample_source,line_list_data[i][col_name.requester]=requester,diagnosis=line_list_data[i][col_name.diagnosis],diagnosis=diagnosis.toString(),line_list_data[i][col_name.diagnosis]=diagnosis.trim(),passport_number=line_list_data[i][col_name.passport_number],passport_number=passport_number.toString(),line_list_data[i][col_name.passport_number]=passport_number.trim(),flight_number=line_list_data[i][col_name.flight_number],flight_number=flight_number.toString(),line_list_data[i][col_name.flight_number]=flight_number.trim(),seat_number=line_list_data[i][col_name.seat_number],seat_number=seat_number.toString(),line_list_data[i][col_name.seat_number]=seat_number.trim(),line_list_data[i][col_name.is_contacted]=is_contacted,line_list_data[i][col_name.is_contacted_with]=contact_with.trim(),line_list_data[i][col_name.is_directed_contact]=is_direct_contact,line_list_data[i][col_name.collected_date]=collected_date.format("YYYY-MM-DD")+" "+collected_time.format("HH:mm:ss"),line_list_data[i][col_name.received_date]=received_date.format("YYYY-MM-DD")+" "+received_time.format("HH:mm:ss"),line_list_data[i][col_name.completed_by]=completed_by.trim(),line_list_data[i][col_name.phone_completed_by]=phone_number.trim(),line_list_data[i][col_name.sample_collector]=sample_collector.trim(),line_list_data[i][col_name.phone_number_sample_collctor]=phone_number_sample_collector.trim(),line_list_data[i][col_name.sample_source_id]=sample_source_id,line_list_data[i][col_name.requester_id]=requester_id,line_list_data[i][col_name.test_name]=test_name,line_list_data[i][col_name.test_id]="-1"==test_id?"":test_id,line_list_data[i][col_name.patient_name]=name.trim(),data.push(line_list_data[i]),array_check.push(!0)):array_check.push(!1)}}return 0==valid_check?(myDialog.showProgress("hide"),myDialog.showDialog("show",{text:msg.not_data_entry,style:"warning"}),$(this).removeClass("disabled"),!1):(console.log("Check "+array_check.indexOf(!1)),array_check.indexOf(!1)>=0?(myDialog.showProgress("hide"),$("table[name=tblErrorLineList] tbody").html(""),$("table[name=tblErrorLineListNew] tbody").html(require_string),$modal_list_error.modal("show"),$(this).removeClass("disabled"),!1):data.length>maxRow?(myDialog.showProgress("hide"),myDialog.showDialog("show",{text:msg.not_greater_than_100_row,style:"warning"}),$(this).removeClass("disabled"),!1):void $.ajax({url:base_url+"/patient/add_line_list_full_form",type:"POST",data:{data:data},dataType:"json",success:function(e){var t=e.patients,a="",l="",n=1,_="";for(var s in t){var i="",o="";void 0!==t[s].psample_id&&(i='<button type="button" class="btn btn-sm btn-success btnPrintCovidFormV1" data-psample_id="'+t[s].psample_id+'" title="'+label_print_lab_form+'"><i class="fa fa-eye"></i></button>',l+=t[s].psample_id+"n"),void 0!==t[s].test_result_msg&&(o=t[s].test_result_msg),a+="<tr>",a+="<td>"+n+"</td>",a+="<td>"+t[s].patient_code+"</td>",a+="<td>"+t[s].patient_name+"</td>",a+="<td>"+t[s].msg+"</td>",a+="<td>"+t[s].sample_number+"</td>",a+="<td>"+t[s].sample_msg+"</td>",a+="<td>"+t[s].test_msg+"</td>",a+="<td>"+o+"</td>",a+="<td>"+i+"</td>",a+="</tr>",_+='<tr data-patient_code="'+t[s].patient_code+'">',_+='<td style="text-align:center; vertical-align:middle;"></td>',_+='<td style="text-align:center; vertical-align:middle;"><span>'+t[s].patient_code+"</span></td>",_+="</tr>",n++}setTimeout(function(){myDialog.showProgress("hide"),$("table[name=tblResultLineListNew] tbody").html(a);var e=l.substring(0,l.length-1);$("#printAll").attr("data-psample_id",e),$("#modal_result_line_list_new").modal("show"),$("table[name=tbl_qr_code] tbody").html(_);var n=Object.keys(col_name).length;for(r=0;r<t.length;r++)for(c=0;c<n;c++)line_list_table_short_form.setValue(jspreadsheet.getColumnNameFromId([c,r]),"");$("#btnSaveListShorFormTest").removeClass("disabled")},1e3)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");console.log(err.Message),console.log(xhr.responseText)}}))}),$modal_excel_short_form.find("select[name=test_name]").on("change",function(){var e=$("select[name=test_name] option:selected").text(),t=$(this).val();if(test_id=$(this).val(),console.log(e),"-1"==t)for(var a=0;a<maxRow;a++)line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.machine_name,a]),!0),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.test_result,a]),!0),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.test_result_date,a]),!0),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.perform_by,a]),!0);else for(a=0;a<maxRow;a++)line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.machine_name,a]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.test_result,a]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.test_result_date,a]),!1),line_list_table_short_form.setReadOnly(jspreadsheet.getColumnNameFromId([col_name.perform_by,a]),!1)});var $modal_upload_excel=$("#modal_upload_excel"),$btnSubmitExcelFile=$("#btnSubmitExcelFile");function getRequesterArray(e){var t=[];return $.each(REQUESTER,function(a,l){e==l.sample_source_id&&t.push(l.requester_name)}),t}function getDistrictsArray(e){var t=[];return"en"==app_language?$.each(DISTRICTS,function(a,l){e==l.province_code&&t.push(l.name_en)}):$.each(DISTRICTS,function(a,l){e==l.province_code&&t.push(l.name_kh)}),t}function getCommunesArray(e){var t=[];return"kh"==app_language?$.each(COMMUNES,function(a,l){e==l.district_code&&t.push(l.name_kh)}):$.each(COMMUNES,function(a,l){e==l.district_code&&t.push(l.name_en)}),t}function getVillagesArray(e){var t=[];return"kh"==app_language?$.each(VILLAGES,function(a,l){e==l.commune_code&&t.push(l.name_kh)}):$.each(VILLAGES,function(a,l){e==l.commune_code&&t.push(l.name_en)}),t}function getTestResultsArray(e){var t=[],a=result_arr[e];if(a.length>0)for(var l in a)t.push(a[l].organism_name);return t}function ExcelDateToJSDate(e){var t=Math.floor(e-25569),a=new Date(1e3*(86400*t)),l=e-Math.floor(e)+1e-7,n=Math.floor(86400*l),_=n%60;n-=_;var r=Math.floor(n/3600),s=Math.floor(n/60)%60;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),r,s,_)}$("#btnOpenUploadFileModal").on("click",function(e){$modal_upload_excel.modal("show")}),$("input[type=file]").change(function(){var e=$("#theExcelFile_message"),t=$(this).val().toLowerCase();new RegExp("(.*?).(xlsx|xls)$").test(t)?(e.html(""),$btnSubmitExcelFile.removeAttr("disabled")):(e.html("Please select correct file format"),$btnSubmitExcelFile.attr("disabled",!0))}),$("#theUploadForm").submit(function(e){e.preventDefault(),myDialog.showProgress("show"),$btnSubmitExcelFile.html("Please wait ...").attr("disabled","disabled"),$.ajax({url:base_url+"/patient/upload_file",type:"post",data:new FormData(this),processData:!1,contentType:!1,cache:!1,async:!1,dataType:"json",success:function(e){if(e.status){e.filename;var t=e.data.values,a=0,l=1,n=new Date,_={patient_code:"A",patient_name:"B",age:"C",gender:"D",phone:"E",province:"F",district:"G",commune:"H",village:"I",residence:"J",reason_for_testing:"K",is_contacted:"L",is_contacted_with:"M",is_directed_contact:"N",sample_number:"O",sample_source:"P",requester:"Q",collected_date:"R",received_date:"S",diagnosis:"T",completed_by:"U",phone_completed_by:"V",sample_collector:"W",phone_number_sample_collctor:"X",clinical_symptom:"Y",health_facility:"Z",test_name:"AA",machine_name:"AB",test_result:"AC",test_result_date:"AD",perform_by:"AE",country:"AF",nationality:"AG",arrival_date:"AH",passport_number:"AI",flight_number:"AJ",seat_number:"AK",is_positive_covid:"AL",test_date:"AM",number_of_sample:"AN",vaccination_status:"AO",first_vaccinated_date:"AP",second_vaccinated_date:"AQ",vaccine_name:"AR",occupation:"AS"};for(var r in console.log(t),t)if(console.log(r+" "+a),a<500){console.log(t[r][_.patient_name]+" "+t[r][_.patient_code]),patient_code=null==t[r][_.patient_code]||""==t[r][_.patient_code]?"":t[r][_.patient_code].trim(),patient_name=null==t[r][_.patient_name]||""==t[r][_.patient_name]?"":t[r][_.patient_name].trim(),""!==patient_code&&(patient_code.length>60?line_list_table_new.setComments(letter_col_name.patient_code+l,msg.not_greater_than_60):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.patient_code,a]),patient_code)),""!==patient_name&&(patient_name.length>60?line_list_table_new.setComments(letter_col_name.patient_name+l,msg.not_greater_than_60):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.patient_name,a]),patient_name)),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.age,a]),t[r][_.age]);var s=null==t[r][_.gender]||null==t[r][_.gender]?"":t[r][_.gender];""!==s&&("-1"==gender_array.indexOf(s)?line_list_table_new.setComments(letter_col_name.gender+l,'"'+s+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.gender,a]),s));var i=null==t[r][_.phone]||null==t[r][_.phone]?"":t[r][_.phone];""!==i&&(i=(i=i.toString()).trim()),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.phone,a]),i);var o=null==t[r][_.province]||null==t[r][_.province]?"":t[r][_.province].trim(),c="";""!==o&&("en"==app_language?province_index=province_array.findIndex(e=>o.toLowerCase()===e.toLowerCase()):province_index=province_array.indexOf(o),"-1"==province_index?line_list_table_new.setComments(letter_col_name.province+l,'"'+o+'" '+msg.not_correct):(line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.province,a]),province_array[province_index]),c=line_list_table_new.getValueFromCoords(col_name.province_code,a)));var m=null==t[r][_.district]||null==t[r][_.district]?"":t[r][_.district].trim(),d="";if(""!==m)if(""==c)line_list_table_new.setComments(letter_col_name.district+l,msg.select_province_first);else{var u=getDistrictsArray(c);"en"==app_language?district_index=u.findIndex(e=>m.toLowerCase()===e.toLowerCase()):district_index=u.indexOf(m),"-1"==district_index?line_list_table_new.setComments(letter_col_name.district+l,'"'+m+'" '+msg.not_correct):(line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.district,a]),u[district_index]),d=line_list_table_new.getValueFromCoords(col_name.district_code,a))}var p=null==t[r][_.commune]||null==t[r][_.commune]?"":t[r][_.commune].trim(),h="";if(""!==p)if(""==d)line_list_table_new.setComments(letter_col_name.commune+l,msg.select_district_first);else{var g=getCommunesArray(d);"en"==app_language?commune_index=g.findIndex(e=>p.toLowerCase()===e.toLowerCase()):commune_index=g.indexOf(p),"-1"==commune_index?line_list_table_new.setComments(letter_col_name.commune+l,'"'+p+'" '+msg.not_correct):(line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.commune,a]),g[commune_index]),h=line_list_table_new.getValueFromCoords(col_name.commune_code,a))}var b=null==t[r][_.village]||null==t[r][_.village]?"":t[r][_.village].trim();if(""!==b)if(""==h)line_list_table_new.setComments(letter_col_name.village+l,msg.select_commune_first);else{var f=getVillagesArray(h);"en"==app_language?village_index=f.findIndex(e=>b.toLowerCase()===e.toLowerCase()):village_index=f.indexOf(b),"-1"==village_index?line_list_table_new.setComments(letter_col_name.village+l,'"'+b+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.village,a]),f[village_index])}var v=null==t[r][_.residence]||null==t[r][_.residence]?"":t[r][_.residence].trim();""!==v&&(v.length>100?line_list_table_new.setComments(letter_col_name.residence+l,'"'+v+'" '+msg.not_greater_than_100):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.residence,a]),v));var y=null==t[r][_.reason_for_testing]||null==t[r][_.reason_for_testing]?"":t[r][_.reason_for_testing].trim();""!==y&&("en"==app_language?reason_for_testing_index=reason_for_testing_array.findIndex(e=>y.toLowerCase()===e.toLowerCase()):reason_for_testing_index=reason_for_testing_array.indexOf(y),"-1"==reason_for_testing_index?line_list_table_new.setComments(letter_col_name.reason_for_testing+l,'"'+y+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.reason_for_testing,a]),reason_for_testing_array[reason_for_testing_index])),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted,a]),t[r][_.is_contacted]),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.is_contacted_with,a]),t[r][_.is_contacted_with]),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.is_directed_contact,a]),t[r][_.is_directed_contact]);var x=null==t[r][_.sample_number]||null==t[r][_.sample_number]?"":t[r][_.sample_number].trim();""!==x&&(x.length>maxSampleNumber?line_list_table_new.setComments(letter_col_name.sample_number+l,'"'+x+'" '+msg.not_greater_than+" "+maxSampleNumber+" "+msg.char):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.sample_number,a]),x));var C="",j="";""!==(C=null==t[r][_.sample_source]||null==t[r][_.sample_source]?"":t[r][_.sample_source].trim())&&("-1"==sample_source_array.indexOf(C)?line_list_table_new.setComments(_.sample_source+l,'"'+C+'" '+msg.not_correct):(line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.sample_source,a]),C),j=line_list_table_new.getValueFromCoords(col_name.sample_source_id,a)));var w=null==t[r][_.requester]||null==t[r][_.requester]?"":t[r][_.requester].trim();if(""!==w)if(""==j)line_list_table_new.setComments(letter_col_name.requester+l,msg.select_sample_source_first);else"-1"==getRequesterArray(j).indexOf(w)?line_list_table_new.setComments(letter_col_name.requester+l,'"'+w+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.requester,a]),w);var I=null==t[r][_.collected_date]||null==t[r][_.collected_date]?"":t[r][_.collected_date];if(""!==I){var N=ExcelDateToJSDate(I),F=String(N.getDate()).padStart(2,"0"),V=String(N.getMonth()+1).padStart(2,"0");I=N.getFullYear()+"-"+V+"-"+F+" "+N.getHours()+":"+N.getMinutes(),N>n?line_list_table_new.setComments(letter_col_name.collected_date+l,'"'+I+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.collected_date,a]),I)}var k=null==t[r][_.received_date]||null==t[r][_.received_date]?"":t[r][_.received_date];if(""!==k){var R=ExcelDateToJSDate(k);F=String(R.getDate()).padStart(2,"0"),V=String(R.getMonth()+1).padStart(2,"0");k=R.getFullYear()+"-"+V+"-"+F+" "+R.getHours()+":"+R.getMinutes(),R>n?line_list_table_new.setComments(_.received_date+l,'"'+k+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.received_date,a]),k)}var S=null==t[r][_.diagnosis]||null==t[r][_.diagnosis]?"":t[r][_.diagnosis].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.diagnosis,a]),S);var T=null==t[r][_.completed_by]||null==t[r][_.completed_by]?"":t[r][_.completed_by].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.completed_by,a]),T);var q=null==t[r][_.phone_completed_by]||null==t[r][_.phone_completed_by]?"":t[r][_.phone_completed_by].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.phone_completed_by,a]),q);var $=null==t[r][_.sample_collector]||null==t[r][_.sample_collector]?"":t[r][_.sample_collector].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.sample_collector,a]),$);var D=null==t[r][_.phone_number_sample_collctor]||null==t[r][_.phone_number_sample_collctor]?"":t[r][_.phone_number_sample_collctor].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.phone_number_sample_collctor,a]),D),""!==(null==t[r][_.clinical_symptom]||null==t[r][_.clinical_symptom]?"":t[r][_.clinical_symptom].trim())&&line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.clinical_symptom,a]),t[r][_.clinical_symptom]);var E=null==t[r][_.health_facility]||null==t[r][_.health_facility]?"":t[r][_.health_facility].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.health_facility,a]),E);var O=null==t[r][_.test_name]||null==t[r][_.test_name]?"":t[r][_.test_name].trim(),A="";""!==O&&(test_name_index=test_name_array.findIndex(e=>O.toLowerCase()===e.toLowerCase()),"-1"==test_name_index?line_list_table_new.setComments(letter_col_name.test_name+l,'"'+O+'" '+msg.not_correct):(line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.test_name,a]),test_name_array[test_name_index]),A=line_list_table_new.getValueFromCoords(col_name.test_id,a)));var M=null==t[r][_.machine_name]||null==t[r][_.machine_name]?"":t[r][_.machine_name].trim();""!==M&&(machine_name_index=machine_name_array.findIndex(e=>M.toLowerCase()===e.toLowerCase()),"-1"==machine_name_index?line_list_table_new.setComments(letter_col_name.machine_name+l,'"'+M+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.machine_name,a]),machine_name_array[machine_name_index]));var Y=null==t[r][_.test_result]||null==t[r][_.test_result]?"":t[r][_.test_result].trim();if(""!==Y)if(""==A)line_list_table_new.setComments(letter_col_name.test_result+l,msg.select_test_name);else{var P=getTestResultsArray(A);test_result_index=P.findIndex(e=>Y.toLowerCase()===e.toLowerCase()),"-1"==test_result_index?line_list_table_new.setComments(letter_col_name.test_result+l,'"'+Y+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.test_result,a]),P[test_result_index])}var L=null==t[r][_.test_result_date]||null==t[r][_.test_result_date]?"":t[r][_.test_result_date];if(""!==L){var H=ExcelDateToJSDate(L);F=String(H.getDate()).padStart(2,"0"),V=String(H.getMonth()+1).padStart(2,"0");L=H.getFullYear()+"-"+V+"-"+F,H>n?line_list_table_new.setComments(letter_col_name.test_result_date+l,'"'+L+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.test_result_date,a]),L)}var U=null==t[r][_.perform_by]||null==t[r][_.perform_by]?"":t[r][_.perform_by].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.perform_by,a]),U);var G=null==t[r][_.country]||null==t[r][_.country]?"":t[r][_.country].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.country,a]),G);var J=null==t[r][_.nationality]||null==t[r][_.nationality]?"":t[r][_.nationality].trim();""!==J&&(nationality_index=nationalities_array.findIndex(e=>J.toLowerCase()===e.toLowerCase()),"-1"==nationality_index?line_list_table_new.setComments(letter_col_name.nationality+l,'"'+J+'" '+msg.not_correct):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.nationality,a]),nationalities_array[nationality_index]));var B=null==t[r][_.arrival_date]||null==t[r][_.arrival_date]?"":t[r][_.arrival_date];if(""!==B){var Q=ExcelDateToJSDate(B);F=String(Q.getDate()).padStart(2,"0"),V=String(Q.getMonth()+1).padStart(2,"0");B=Q.getFullYear()+"-"+V+"-"+F,Q>n?line_list_table_new.setComments(letter_col_name.arrival_date+l,'"'+B+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.arrival_date,a]),B)}var K=null==t[r][_.passport_number]||null==t[r][_.passport_number]?"":t[r][_.passport_number].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.passport_number,a]),K);var W=null==t[r][_.flight_number]||null==t[r][_.flight_number]?"":t[r][_.flight_number].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.flight_number,a]),W);var X=null==t[r][_.seat_number]||null==t[r][_.seat_number]?"":t[r][_.seat_number].trim();line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.seat_number,a]),X),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.is_positive_covid,a]),t[r][_.is_positive_covid]),line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,a]),t[r][_.test_date]);var z=null==t[r][_.test_date]||null==t[r][_.test_date]?"":t[r][_.test_date];if(""!==z){var Z=ExcelDateToJSDate(z);F=String(Z.getDate()).padStart(2,"0"),V=String(Z.getMonth()+1).padStart(2,"0");z=Z.getFullYear()+"-"+V+"-"+F,Z>n?line_list_table_new.setComments(letter_col_name.test_date+l,'"'+z+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.test_date,a]),z)}line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.number_of_sample,a]),t[r][_.number_of_sample]);var ee=null==t[r][_.vaccination_status]||null==t[r][_.vaccination_status]?"":t[r][_.vaccination_status];if(""!==ee){line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccination_status,a]),ee);var te=null==t[r][_.first_vaccinated_date]||null==t[r][_.first_vaccinated_date]?"":t[r][_.first_vaccinated_date];if(""!==te){var ae=ExcelDateToJSDate(te);F=String(ae.getDate()).padStart(2,"0"),V=String(ae.getMonth()+1).padStart(2,"0");te=ae.getFullYear()+"-"+V+"-"+F,ae>n?line_list_table_new.setComments(letter_col_name.first_vaccinated_date+l,'"'+te+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.first_vaccinated_date,a]),te)}var le=null==t[r][_.second_vaccinated_date]||null==t[r][_.second_vaccinated_date]?"":t[r][_.second_vaccinated_date];if(""!==le){var ne=ExcelDateToJSDate(le);F=String(ne.getDate()).padStart(2,"0"),V=String(ne.getMonth()+1).padStart(2,"0");le=ne.getFullYear()+"-"+V+"-"+F,ne>n?line_list_table_new.setComments(letter_col_name.second_vaccinated_date+l,'"'+le+'" '+msg.not_greater_than_current_date):line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.second_vaccinated_date,a]),le)}var _e=null==t[r][_.vaccine_name]||null==t[r][_.vaccine_name]?"":t[r][_.vaccine_name];line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.vaccine_name,a]),_e);var re=null==t[r][_.occupation]||null==t[r][_.occupation]?"":t[r][_.occupation];line_list_table_new.setValue(jspreadsheet.getColumnNameFromId([col_name.occupation,a]),re)}a++,l++}setTimeout(()=>{myDialog.showProgress("hide"),$modal_upload_excel.modal("hide"),$btnSubmitPatientForm.removeAttr("disabled"),$btnSubmitExcelFile.removeAttr("disabled"),$btnSubmitExcelFile.removeAttr("disabled"),$btnSubmitExcelFile.html("Submit"),0==a?myDialog.showDialog("show",{text:mg.excel_none_data_again,style:"warning"}):a>500?myDialog.showDialog("show",{text:msg.data_over_max_only_500_added,style:"warning"}):myDialog.showDialog("show",{text:msg.data_inserted_successful,style:"success"})},800)}else myDialog.showProgress("hide"),setTimeout(()=>{myDialog.showDialog("show",{text:e.msg,style:"warning"}),$btnSubmitExcelFile.removeAttr("disabled")},500)}})}),$(document).on("click","button.btnQrCode",function(e){e.preventDefault();var t=$(this).attr("data-patient_code");$("#tbl_qr_code tbody tr").each((e,a)=>{"-1"==t?$(a).removeClass("no-print"):t!==$(a).attr("data-patient_code")?$(a).addClass("no-print"):$(a).removeClass("no-print")}),printJS({printable:"tbl_qr_code_wrapper",type:"html",style:["@page { size: auto; margin: 0mm;} @media print{#tbl_qr_code_wrapper {width:50mm; height: 23mm;} span{font-size:10px;} .no-print, .no-print *{display: none !important;} }"],targetStyles:["*"]})})});